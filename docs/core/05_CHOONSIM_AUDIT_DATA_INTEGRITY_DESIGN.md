# [기술 설계] 신뢰 기반 데이터 무결성 검증 (Audit) 시스템 상세 설계

본 문서는 BondBase 프로젝트의 Phase 2 핵심 과제인 '데이터 무결성 검증' 시스템의 아키텍처와 상세 로직을 정의합니다. 본 시스템은 "BondBase 백엔드가 매출 데이터를 임의로 조작할 수 있는가?"라는 투자자의 근본적인 의구심을 기술적으로 해결합니다.

## 1. 설계 철학: "Trust, but Verify" (신뢰하되 검증하라)

Phase 1에서는 외부 프로젝트(춘심 AI-Talk)로부터 매출 데이터를 직접 수신하여 기록하는 데 집중했습니다. Phase 2에서는 **Creditcoin Universal Oracle (CUO)**을 도입하여, 기록된 데이터가 원천 데이터(Source of Truth)와 일치하는지를 제3의 검증자(Oracle)가 확증하는 단계를 추가합니다.

## 2. 오라클 시스템 아키텍처 (The Auditor)

검증 시스템은 다음 세 단계의 '증명 파이프라인'을 거칩니다.

### 2.1 Trigger: 검증 요청의 자동 생성
- **발생 시점**: BondBase 백엔드 API(`api/revenue`)에 새로운 매출 데이터가 수신되는 즉시 작동합니다.
- **작동 방식**: 백엔드는 수신된 데이터를 DB에 기록함과 동시에, Creditcoin 네트워크 상의 오라클 컨트랙트에 '검증 요청 트랜잭션'을 보냅니다.
- **포함 정보**: 검증할 매출 ID, 요청 금액, 원천 데이터 소스(예: PayPal Transaction ID 또는 결제 서버 API 엔드포인트).

### 2.2 Verification: 독립적인 교차 검증 (Zero-Trust Isolation)
- **검증 주체**: **Creditcoin Universal Oracle (CUO)** 노드.
- **핵심 원칙 (중요)**: 본 설계는 BondBase와 춘심 AI-Talk 백엔드가 서로 공모하여 데이터를 조작할 가능성을 사전에 차단하는 **Zero-Trust** 모델을 따릅니다. 따라서 오라클은 관리자의 통제권이 미치는 프로젝트 백엔드 DB를 신뢰하지 않으며, 오직 조작이 불가능한 **'제3의 외부 시스템'**만을 검증 근거로 삼습니다.
- **원천 데이터 소스 (Independent Source of Truth)**:
    1. **글로벌 결제 Gateway (PayPal, Stripe, Toss 등)**: 실제 자금이 오간 결제 대행사의 수취 완료 API 로그를 직접 조회합니다.
    2. **공식 앱 스토어 정산 시스템**: Apple App Store 및 Google Play Store의 개발자 리포트 API를 통해 매출의 진위 여부를 확인합니다.
    3. **온체인 트랜잭션**: 가상자산 결제 건의 경우, 공개된 블록체인 익스플로러를 통해 수취 지갑으로의 자금 이동을 직접 검증합니다.
- **검증 작업**: 오라클 노드는 상기 명시된 외부 시스템에 직접 접속하여 [BondBase가 기록한 금액 === 외부 시스템의 실제 수취 금액] 여부를 1:1로 엄격히 대조합니다.

### 2.3 On-chain Attestation: 온체인 증명 전송
- **결과 기록**: 검증이 성공하면 오라클 노드는 자신의 개인키로 서명된 **증명(Proof)** 값을 스마트 컨트랙트에 전송합니다.
- **데이터 무결성**: 이 과정에서 데이터가 단 1원이라도 다르다면 증명은 거부되며, 시스템은 '검증 실패' 상태를 유지합니다.

## 3. 스마트 컨트랙트 제어 로직 (Guard Logic)

데이터의 진실성이 확인되기 전까지 자금의 흐름을 통제하기 위해 `YieldDistributor.sol`에 다음과 같은 보호 장치를 도입합니다.

### 3.1 Pending Yield 개념 도입
- **상태의 분리**: 매출 데이터가 입력된 직후의 세션은 **`PENDING`** 상태로 관리됩니다. 이 상태에서는 사용자가 수익을 조회할 수는 있지만, 실제로 출금(Claim)하거나 재투자(Reinvest)할 수 없습니다.
- **잠금(Lock)**: 입력된 금액만큼의 유동성은 프로콜 내에 '확정 대기' 상태로 묶입니다.

### 3.2 Oracle-driven Unlock (해제 조건)
- **증명 수신**: 컨트랙트가 오라클로부터 유효한 `Attestation`을 수신하는 순간, 해당 세션은 **`VERIFIED`**로 전환됩니다.
- **가용성 확보**: 검증된 수익에 한해서만 투자자는 자신의 지갑으로 현금화(USDC 추출)하거나 추가 채권을 구매하는 권한을 갖게 됩니다.

## 4. 투자자 신뢰 지표 (UI/UX 연동)

본 설계는 대시보드 UI 상에서 다음과 같이 시각화되어 신뢰를 가시화합니다.

- **Audit Status Badge**: 각 매출 내역 옆에 'Pending verification' 또는 'Verified by Creditcoin Oracle' 배지를 표시합니다.
- **Transparency Report**: 오라클이 검증한 원천 데이터의 해시값과 대조 일시를 투명하게 공개하여 투자자가 직접 대조해 볼 수 있는 환경을 제공합니다.

---

**결론**: 이 오라클 기반 감사 시스템을 통해 BondBase는 단순한 데이터 기록 플랫폼을 넘어, **"조작 불가능한 실물 자산 수익률(Immutable Real Yield)"**을 제공하는 신뢰 기관으로 완성됩니다.

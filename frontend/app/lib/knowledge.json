[
  {
    "source": "01_Foundation/00_PROJECT_OVERVIEW.md",
    "content": "# 프로젝트 개요 (Project Overview)\n> Created: 2026-01-26 00:46\n> Last Updated: 2026-02-09\n\n## 1. 프로젝트 비전 (Vision)\n- **\"IP 수익권 기반의 차세대 RWA 런치패드\"**\n- 강력한 글로벌 팬덤을 보유한 **'춘심(ChoonSim)'** IP의 수익권을 온체인 자산화(USDC 페깅)하여 투명한 수익 배분을 실현합니다.\n- 투자자에게는 IP 성장과 연동된 수익을, IP 보유자에게는 팬덤 기반의 유동성을 제공하는 정서적 투자 생태계 구축을 목표로 합니다.\n\n## 2. 핵심 인프라 스택 (Key Infrastructure)\n\n### 2.1 Blockchain & Smart Contracts\n- **Network**: Creditcoin 3.0 (CC3) Testnet\n- **Protocol**: BondBase RWA Protocol (ERC-1155 기반 수익권 토큰화)\n- **Oracle**: Creditcoin Universal Oracle (실물 매출 데이터 온체인 검증용 Audit 시스템)\n\n### 2.2 Backend & Data\n- **Database**: Turso (libSQL) / Drizzle ORM\n- **Runtime**: Vercel Edge Runtime / Node.js\n- **Secret Management**: Cloud-native environments (.env.production / Vercel Secrets)\n\n### 2.3 AI & Intelligence\n- **Engine**: Google Gemini 2.5 Flash (Primary) / OpenAI GPT-4O (Fallback)\n- **Framework**: Vercel AI SDK (Core + React)\n- **Knowledge Base**: RAG (Static Context via `knowledge.json` + Live DB Data)\n\n### 2.4 Frontend\n- **Framework**: React Router v7 (Vite)\n- **Styling**: Tailwind CSS v4 / shadcn/ui\n- **Icons**: Lucide Icons, Hugeicons\n\n---\n\n## X. Related Documents\n- **Foundation**: [Integration Plan](./01_INTEGRATION_PLAN.md) - BondBase x 춘심 통합 기획 전략\n- **Foundation**: [Roadmap](./03_ROADMAP.md) - 단계별 실행 계획 및 마일스톤\n- **Specs**: [Infrastructure Specs](../03_Specs/01_INFRASTRUCTURE.md) - 기술 인프라 명세\n"
  },
  {
    "source": "01_Foundation/01_INTEGRATION_PLAN.md",
    "content": "# BondBase x 춘심 AI-Talk: 글로벌 IP 기반 RWA 혁신 모델\n> Created: 2026-01-24 23:18\n> Last Updated: 2026-02-09 03:51\n\n## 1. 프로젝트 비전\n**\"금융의 감성적 대중화와 IP 가치의 온체인 자산화\"**\n본 프로젝트는 기존의 딱딱한 금융 자산 위주였던 BondBase RWA 프로토콜을, 강력한 글로벌 팬덤을 보유한 '춘심(Choonsim)' IP와 결합하여 **IP 수익권 기반의 차세대 RWA 런치패드**로 재구성하는 것을 목표로 합니다.\n\n## 2. 시장 기회를 활용한 글로벌 유동성 전략\n\n춘심 프로젝트의 핵심 자산은 **일본과 남미 지역이 70% 이상을 차지하는 거대하고 충성도 높은 글로벌 팬덤**입니다. 본 모델은 이 두 지역의 상반된 금융 니즈를 BondBase의 RWA 기술로 해결합니다.\n\n### 2.1 남미 시장: \"자산 보호의 수단으로서의 RWA\"\n브라질, 아르헨티나 등 남미 팬들은 고질적인 자국 화폐 가치 하락(인플레이션)에 매우 민감합니다. \n- **전략**: 춘심 AI-Talk 수익권을 스테이블코인(USDC 등) 기반 RWA로 제공하여 팬들이 춘심이를 응원하는 동시에 자신의 자산을 안정적인 가치에 묶어둘 수 있는 **'감성적 헤지(Hedge)'** 수단을 제공합니다. \n\n### 2.2 일본 시장: \"초저금리 대안인 수집형 투자 문화\"\n일본 팬들은 세계 최고 수준의 캐릭터 충성도를 지니고 있지만, 은행의 극히 낮은 금리에는 불만족하고 있습니다.\n- **전략**: 높은 금리뿐만 아니라 **'성장하는 캐릭터와 함께하는 장기 투자'**라는 정서적 가치를 병합합니다. RWA 토큰 보유자에게 한정판 디지털 자산(NFT)이나 굿즈 우선권을 결합하여 투자를 하나의 '놀이와 수집'의 영역으로 확장합니다.\n\n### 2.3 Cross-Border Yield: 글로벌 유동성의 선순환\n남미와 일본 팬들이 춘심 성장 채권에 투자한 자금은 BondBase 프로토콜을 통해 다음과 같이 운용됩니다.\n1. **유동성 확보**: 글로벌 팬덤으로부터 즉각적인 대규모 유동성 확보.\n2. **실물 운용**: 해당 자금을 태국 및 신흥 시장의 고수익 소상공인 대출 채권에 운용하여 실질적인 수익률(Real Yield) 확보.\n3. **가치 환원**: 발생한 수익을 다시 춘심이의 이름으로 전 세계 팬들에게 배당함으로써, 춘심이가 **\"팬들의 관심을 모아 성장이 필요한 곳에 힘을 실어주는 메신저\"**가 되게 함.\n\n## 3. 핵심 아키텍처: Choonsim Growth Bond\n\n### 3.1 자산의 정의 (Underlying Asset)\n단순한 가상 에셋이 아닌, 실제 발생하는 **프로젝트 현금 흐름**을 자산화합니다. \n- **수익원**: 춘심 AI-Talk 서비스의 월 구독료, IP 라이선스 로열티, 글로벌 굿즈 판매 매출 및 이벤트 수익.\n- **토큰화**: BondBase의 ERC-1155 기술을 사용하여 미래 수익권을 분할 발행합니다. 투자자는 '채권'을 구매하는 동시에 '춘심이의 미래'를 공동 소유하게 됩니다.\n\n### 3.2 수익률(Yield) 및 보상 구조\n기존 태국 채권이 '대출 이자'만을 수익원으로 했다면, 춘심 RWA는 팬덤 비즈니스의 특성을 반영한 다중 수익 체계를 가집니다.\n1. **구독 매출 배당 (Revenue Share)**: 실제 발생하는 월 매출의 일정 비율을 스마트 컨트랙트를 통해 투명하게 배당.\n2. **마일스톤 보너스 (Milestone Bonus)**: 프로젝트의 성장을 홀더와 축하하기 위해 X 팔로워 특정 수치 달성, 신규 국가 진출, 앱 다운로드 기록 경신 시 특별 배당금을 지급.\n\n### 3.3 투자자 혜택 (Loyalty & Synergy)\n투자자를 단순히 돈을 빌려준 사람이 아닌 'VIP 팬'으로 대우합니다.\n- **감성적 임팩트 리포팅**: 춘심 AI-Talk 대화 중에 춘심이가 직접 본인의 성장 소식과 배당 발생 소식을 감성적으로 전달합니다. (\"우리 투자 덕분에 태국 카페 사장님이 새 기계를 들이셨대! 정말 뿌듯해!\")\n- **홀더 전용 대화 채널**: 일정 수량 이상의 토큰 보유 시에만 열리는 춘심이와의 심층 대화 페르소나 적용.\n- **거버넌스 참여**: 춘심이의 다음 시즌 코스튬이나 신규 대화 컨셉 결정 시 투자 지분에 따른 투표권 행사.\n\n## 4. BondBase 프로토콜의 역할 변화 및 가치\n\n본 모델이 도입되면 BondBase는 단순 중개 플랫폼에서 **\"AI/IP 엑셀러레이팅 런치패드\"**로 진화합니다.\n- **신뢰 보증**: 춘심 프로젝트의 매출 데이터를 온체인(Creditcoin 2.0 Oracle 등)에 실시간으로 기록하여 배당금의 정당성을 블록체인으로 증명.\n- **진입 장벽 완화**: 춘심이라는 친숙한 캐릭터를 메신저로 활용하여 일반인들이 기술적 어려움 없이 RWA 투자에 진입하도록 유도.\n\n## 5. 기대 효과\n1. **유동성 문제 해결**: 캐릭터 팬덤을 통한 즉각적인 글로벌 유동성(Liquidity) 확보.\n2. **투자 장벽 완화**: 춘심이라는 친숙한 메신저를 통해 어려운 RWA 금융 개념을 감성적으로 전달.\n3. **ESG 시너지**: 글로벌 팬덤의 자금이 춘심이를 거쳐 태국 소상공인 등의 실물 경제 지원으로 이어지는 선순환 구조 구축.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 전체 프로젝트 비전 및 기술 스택\n- **Foundation**: [Roadmap](./03_ROADMAP.md) - 단계별 실행 계획\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - 춘심 수익 연동 상세 명세\n"
  },
  {
    "source": "01_Foundation/02_BRANDING_PLAN.md",
    "content": "# 플랫폼 정규화 및 춘심 전용 브랜딩 계획\n> Created: 2026-01-25 14:07\n> Last Updated: 2026-02-09 03:52\n\n## 1. 정규화(Normalization) 배경 및 목적\nBondBase 플랫폼은 초기 태국 소상공인 대출(MSME Loan) 모델을 기반으로 설계되었으나, 현재 **춘심 AI-Talk IP** 기반의 RWA로 핵심 사업 모델이 피벗되었습니다. 기존의 태출 대출 관련 명칭, 시각적 자산, 데이터 구조는 투자자에게 혼란을 주며 프로젝트의 전문성을 저해하고 있습니다. \n\n본 계획은 Phase 4 진입 전, 플랫폼의 모든 요소를 춘심 AI-Talk 전용으로 최적화하여 **브랜드 일관성(Brand Consistency)**을 확보하는 데 목적이 있습니다.\n\n## 2. 정규화 대상 및 수정 계획\n\n### 2.1 UI/UX 인터페이스 (Rebranding)\n- **메뉴 명칭 고도화**:\n    - `Impact Map` → `Fandom Impact Map` (태국 지역 지도에서 글로벌 팬덤 분포도로 전환)\n    - `Bond Market` → `Growth Market` 또는 `IP Bond Market`\n- **시각적 자산 교체**:\n    - 기존 태국 농민/소상공인 관련 더미 이미지 전면 제거.\n    - `generate_image` 도구를 활용하여 춘심이의 글로벌 활동(일본, 남미, 메타버스 등)을 상징하는 프리미엄 아트워크로 대체.\n- **용어 정제(Terminology)**:\n    - 'Loan', 'Borrower', 'Repayment' → 'Subscription', 'IP Owner', 'Revenue Share'로 전면 교체.\n\n### 2.2 데이터베이스 및 컨텐츠 (Data Archiving & Filtering)\n- **Legacy 데이터 격리**:\n    - 기존 태국 대출 데이터(Bond ID 1~10)를 삭제하지 않고 `status`를 `LEGACY`로 변경.\n    - 프론트엔드 API 호출 시 `status = 'ACTIVE'` 필터를 적용하여 춘심 관련 데이터만 기본 노출.\n- **컨텐츠 리모델링**:\n    - `Impact Map`의 소스 데이터를 태국 지도에서 글로벌 팬덤 분포로 전환 (인프라는 재사용, 컨텐츠만 교체).\n    - `AI Guide`의 텍스트를 IP RWA 투자 가이드라인으로 전면 개편.\n\n### 2.3 시스템 로직 (System Logic)\n- **Primary Alpha 고정**:\n    - 채권 리스트(`/bonds`) 진입 시, 춘심 채권(ID: 101)을 최상단 Primary Alpha로 고정하고 기존 Legacy 채권은 노출 제외 처리.\n\n## 3. 상세 이행 로드맵\n\n| 단계 | 작업 항목 | 기대 결과 |\n| :--- | :--- | :--- |\n| **Step 1** | 사이드바 및 헤더 용어/아이콘 정규화 | 브랜드 정체성 확립 |\n| **Step 2** | DB 내 더미/Legacy 데이터 청소 | 데이터 무결성 확보 |\n| **Step 3** | Impact Map/AI Guide 컨텐츠 교체 | 유저 혼란 제거 |\n| **Step 4** | 최종 통합 테스트 및 시각적 검수 | Phase 4 진입 준비 완료 |\n\n## 4. 향후 영향도 분석\n- 본 작업은 기존 기능의 로직 변경이 아닌, **표현 계층(Presentation Layer)과 데이터 정규화**에 집중하므로 스마트 컨트랙트의 잔액이나 수익금 계산에는 영향을 미치지 않습니다.\n- 투자자에게는 \"춘심 전용 전문 투자 플랫폼\"이라는 강력한 인상을 심어주어 유입률을 높일 것으로 기대됩니다.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 전체 프로젝트 비전 및 기술 스택\n- **Foundation**: [Roadmap](./03_ROADMAP.md) - 정규화 일정이 포함된 전체 로드맵\n- **Logic**: [Backlog](../04_Logic/00_BACKLOG.md) - 정규화 관련 상세 작업 현황\n"
  },
  {
    "source": "01_Foundation/03_ROADMAP.md",
    "content": "# 실제 작업 구현 로드맵 (Roadmap)\n> Created: 2026-02-01 16:20\n> Last Updated: 2026-02-09 03:53\n\n본 문서는 **춘심톡 연동**과 **현재 프로젝트 UI/UX 업데이트** 두 가지 작업을 진행할 때 **실제 구현의 기준**이 되는 로드맵 문서입니다.\n\n## 1. 문서 사용 방법\n- **작업 전**: 본 문서에서 해당 관점(춘심 연동 / UI/UX)의 구현 계획을 확인하고, 순서와 완료 기준을 파악합니다.\n- **작업 중**: 파일 경로·변경 내용·완료 기준을 따라 수정 후, 해당 항목 체크리스트를 완료 처리합니다.\n- **검수**: 본 문서의 체크리스트와 \"완료 기준\"이 모두 충족되었는지 확인합니다.\n\n---\n\n## 2. Part A: 춘심톡 연동 구현 계획\n\n### A.1 현재 상태\n| 항목 | 상태 | 비고 |\n|------|------|------|\n| BondBase 수익 수집 API | 구현됨 | `frontend/app/routes/api.revenue.ts` |\n| API Key 인증 | 구현됨 | `CHOONSIM_API_KEY` Bearer Token |\n| DB·오라클 봇 | 구현됨 | Turso, `scripts/oracle-bot.js` |\n\n### A.2 구현 작업\n| # | 작업 내용 | 담당/위치 | 완료 기준 | 완료 |\n|---|-----------|-----------|-----------|------|\n| A-1 | 춘심톡 백엔드에 BondBase `api/revenue` 호출 모듈 추가 | 춘심톡 서버 | 환경변수 설정 후 `POST /api/revenue` 호출 가능 | [ ] |\n| A-2 | 실제 결제 이벤트 → REVENUE 전송 플로우 설계 | [Specs](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) | 플로우 다이어그램 및 페이로드 명시 | [ ] |\n| A-3 | 결제 금액과 USDC 단위 매핑 정의 | [Specs](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) | 통화 매핑 로직 코드/문서화 | [ ] |\n| A-4 | 웹훅 보안: 서명 검증 | BondBase | 호출 출처 검증 방식 반영 | [ ] |\n| A-5 | 앱–웹 연동 방식 결정 | [Logic](../04_Logic/00_BACKLOG.md) | WebView / 미니앱 방식 확정 | [ ] |\n\n---\n\n## 3. Part B: UI/UX 업데이트 구현 계획\n\n### B.1 이미 반영된 부분\n- 사이드바 \"Growth Market\", \"Fandom Impact\"\n- \"Growth Market\" 페이지 타이틀\n- \"Fandom Impact\" 맵 타이틀 및 글로벌 뱃지\n- AI 안내 링크 및 홈 페이지 테마 문구\n\n### B.2 구현 작업 (전수 점검 완료)\n- [x] Help Guide 명칭 \"Growth Market\"으로 통일\n- [x] Help Guide 내 춘심 RWA 중심 문구 수정\n- [x] Portfolio 빈 상태 문구 수정\n- [x] \"Bond Market\" 문자열 전수 교체 (knowledge.json 제외)\n- [x] Loan/Borrower/Repayment → Subscription/IP Owner/Revenue Share 교체\n- [x] 레거시 태국 이미지 제거 확인\n- [x] AI Guide 춘심 맥락 업데이트\n- [x] Faucet 및 설정 페이지 문구 점검\n\n---\n\n## 4. 마스터 체크리스트\n- [ ] Part A: 춘심 연동 완료 (A-1 ~ A-5)\n- [x] Part B: UI/UX 브랜딩 정규화 완료 (2026-02-01 검증 완료)\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 프로젝트 비전 명세\n- **Foundation**: [Branding Plan](./02_BRANDING_PLAN.md) - UI 용어 및 정규화 전략\n- **Foundation**: [Integration Plan](./01_INTEGRATION_PLAN.md) - 춘심 연동 기획 원칙\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - 수익 연동 상세 기술 명세\n- **Logic**: [Backlog](../04_Logic/00_BACKLOG.md) - 전체 작업 현황 관리\n"
  },
  {
    "source": "01_Foundation/04_AI_STRATEGY.md",
    "content": "# Phase 4: AI 에이전트 통합 및 지식 고도화 전략\n> Created: 2026-01-25 14:19\n> Last Updated: 2026-02-09\n\n## 1. 개요 (Overview)\nPhase 4는 BondBase의 'AI Concierge'가 단순한 안내 기능을 넘어, **실시간 온체인 데이터 조회**와 **외부 플랫폼(춘심 톡)과의 연동**을 수행할 수 있도록 지능화하는 단계입니다. 사용자는 AI와의 대화를 통해 자신의 투자 현황을 파악하고, 최적의 수익 전략을 제안받을 수 있어야 합니다.\n\n## 2. 목표 (Goals)\n1.  **실시간 지식 동기화 (Live RAG)**: AI가 스마트 컨트랙트의 현재 상태(APR, TVL, 내 잔액)를 조회하여 답변할 수 있어야 함.\n2.  **맥락 인식 투자 제안 (Contextual Advice)**: 사용자의 지갑 연결 여부, 포트폴리오 상태를 인식하여 구체적 제안 가능.\n3.  **외부 연동 준비 (External Linkage)**: 춘심 AI-Talk 앱에서 BondBase의 핵심 기능을 호출할 수 있도록 API 및 지식 베이스 표준화.\n\n## 3. 핵심 과제 (Tasks)\n- **AI Knowledge Base 고도화**: 레거시 데이터 제거 및 춘심 캐릭터 말투(Persona) 반영.\n- **온체인 데이터 조회 도구**: Vercel AI SDK Tools를 활용한 Function Calling 구현.\n  > **현황**: Gemini API 스키마 호환성 이슈로 Tool Calling이 현재 비활성화 상태. 안정화 후 재활성화 예정. (`api.chat.ts` 87행 참조)\n- **춘심 페르소나 미세조정**: 금융 전문용어와 팬덤 은어의 조화로운 사용.\n\n## 4. 기술 스택 (Tech Stack)\n- **AI Engine (Primary)**: Google Gemini 2.5 Flash (`gemini-2.5-flash`)\n- **AI Engine (Fallback)**: OpenAI GPT-4O (`gpt-4o`) - 사용자 선택 가능\n- **Framework**: Vercel AI SDK v6 (Core + React)\n- **Data Source**: Static (`knowledge.json`, 빌드 시 자동 생성) + Dynamic (viem/wagmi RPC)\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 프로젝트 비전 및 기술 스택\n- **Foundation**: [Integration Plan](./01_INTEGRATION_PLAN.md) - 춘심 연동 기획 원칙\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - 수익 연동 API 명세\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 온체인 데이터 검증 로직\n"
  },
  {
    "source": "01_Foundation/05_UI_DESIGN.md",
    "content": "# UI/UX 디자인 가이드라인 (Design Brief)\n> Created: 2026-01-24 10:00\n> Last Updated: 2026-02-09 04:10\n\n## 1. 디자인 컨셉: \"Emotional RWA\"\n- **핵심 가치**: 투명성, 감성적 연결, 전문성.\n- **톤 앤 매너**: 다크 모드 기반의 프리미엄 디자인, 춘심IP의 생동감을 강조하는 비비드한 컬러 포인트(Pink/Cyan), 부드러운 글래스모피즘(Glassmorphism) 효과.\n\n## 2. 디자인 시스템\n- **Typography**: Inter (UI Text), Orbitron (Numerical Data).\n- **Colors**:\n  - Primary: `#FF1493` (Pink - ChoonSim Signature)\n  - Secondary: `#00CED1` (Cyan - Global Impact)\n  - Background: `#050505` (Deep Black)\n- **Components**: 둥근 모서리(Radius 12px+), 심플한 아이콘(Lucide Icons).\n\n## 3. 주요 화면 가이드\n- **Growth Market**: 채권 카드가 카드 형태로 나열되며, 투자 상태에 따라 다른 애니메이션 배경 적용.\n- **Impact Map**: 구글 지도를 활용하여 글로벌 팬덤 데이터를 마커로 표시.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 전체 프로젝트 스택\n- **Foundation**: [Branding Plan](./02_BRANDING_PLAN.md) - UI 용어 및 브랜딩 전략\n- **Prototype**: [UI Resource Lib](../02_Prototype/01_DESIGN_RESOURCES.md) - 실제 디자인 자산 경로\n"
  },
  {
    "source": "01_Foundation/06_HANDOVER.md",
    "content": "# 리뉴얼 전환 및 일단락 기준 (Handover)\n> Created: 2026-01-29 10:00\n> Last Updated: 2026-02-09\n\n본 문서는 **작업이 새로 시작/리뉴얼**됨에 따라, 기존 작업을 일단락하고 새 시작의 기준이 되도록 작성된 전환(Handover) 문서입니다.\n\n## 1. 완료된 항목 (안정성 확보)\n| 항목 | 내용 |\n|------|------|\n| 수익 수집 API | `api/revenue` 수신 및 DB 기록 시스템 완착 |\n| 오라클 봇 | `scripts/oracle-bot.js`를 통한 온체인 반영 로직 검증 완료 |\n| 대시보드 UI | 춘심 전용 Growth Market 및 Impact Map UI 구현 완료 |\n| AI 컨시어지 | Gemini 2.5 Flash 기반 RAG 및 페르소나 적용 완료 (OpenAI GPT-4O 폴백 지원) |\n\n## 2. 미완·보류 항목 (차기 과제)\n- **춘심톡 실연동**: 실제 춘심톡 백엔드에서의 API 호출 연동.\n- **UI 용어 정제**: \"Bond\" 관련 잔존 용어의 \"Growth Bond\" 완전 전환.\n- **기술 부채**: AI Tool Calling 기능의 안정화 및 재활성화. (Gemini API 스키마 호환성 이슈로 비활성화 상태)\n\n## 3. 리뉴얼 이후 원칙\n1. **문서 레이어 준수**: `manage-docs` 스킬에 따른 5단계 레이어 내 문서화 선행 후 개발.\n2. **현행 기준 참조**: `docs/01_Foundation/00_PROJECT_OVERVIEW.md`를 기점으로 작업 확장.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 현재 기술 스택 및 비전\n- **Foundation**: [Roadmap](./03_ROADMAP.md) - 리뉴얼 이후의 마일스톤\n- **Logic**: [Backlog](../04_Logic/00_BACKLOG.md) - 현재 진행 중인 미완료 과제 트래킹\n"
  },
  {
    "source": "01_Foundation/07_SUBMISSION_SPEC.md",
    "content": "# 아이디어톤 제출용 프로젝트 명세서 (Submission Spec)\n> Created: 2026-01-28 15:46\n> Last Updated: 2026-02-09 04:11\n\n## 1. 프로젝트 기본 정보\n- **프로젝트명**: BondBase x ChoonSim (춘심)\n- **분야**: Web3 / RWA (Real World Asset) / AI\n- **핵심 키워드**: IP 수익권 토큰화, Creditcoin 3.0, 복리 재투자(Auto-Compound), AI Intelligence\n\n## 2. 프로젝트 퍼포먼스 (Key Highlights)\n### 2.1 춘심 (ChoonSim) IP의 강력한 자산성\n- 글로벌 숏폼 및 SNS 통합 팬덤 보유.\n- 실물 매출(MD, 라이선싱, AI 서비스 등)이 발생하는 검증된 IP를 온체인 자산으로 수용.\n\n### 2.2 기술적 차별점 (The Edge)\n1. **Universal Oracle 기반 데이터 검증**: 실물 API 데이터를 오라클이 검증하여 온체인 수익(Yield)으로 확정하는 정산 시스템.\n2. **신뢰 기반의 유동성 순환**: USDC 수익을 다시 IP 지분 채권(CHNSM Token)으로 즉시 전환하는 '자동 복리 재투자' 엔진 구현.\n3. **Remix & Edge Runtime 최적화**: 글로벌 지연 없는 금융 대시보드 경험 제공.\n\n## 3. 사용자 여정 (User Journey)\n1. **Discovery**: BondBase 마켓에서 춘심 IP 채권 성과 및 APR 확인.\n2. **Subscription**: USDC를 통한 IP 수익권 구독 및 ERC-1155 지분 토큰 수령.\n3. **Real-time Audit**: 오라클의 24시간 주기 매출 데이터 검증 및 수익 누적.\n4. **Growth Loop**: 수익 현금화(Claim) 또는 재투자(Reinvest)를 통한 지분율 확대.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](./00_PROJECT_OVERVIEW.md) - 전체 프로젝트 비전\n- **Test**: [Completion Summary](../05_Test/01_PHASE_COMPLETION_SUMMARY.md) - 이행 보고서 요약\n"
  },
  {
    "source": "02_Prototype/01_DESIGN_RESOURCES.md",
    "content": "# 디자인 자산 및 프로토타입 링크 (Design Resources)\n> Created: 2026-01-15 10:48\n> Last Updated: 2026-02-09 04:16\n\n## 1. Stitch Project (Main Design Samples)\n- **URL**: [Stitch Project URL](https://stitch.withgoogle.com/projects/17193233867447468760)\n- **Description**: Stitch 팀에서 제작한 BuildCTC 프로젝트 디자인 샘플 및 프로토타입. UI/UX 구현 시 최우선으로 참조되는 디자인 가이드라인입니다.\n\n## 2. AI 에이전트 활용 가이드\n- **Component Development**: Tailwind CSS 및 shadcn/ui 컴포넌트 개발 시 위 URL의 시각적 요소(색상, 간격, 타이포그래피)를 반영함.\n- **Layout Reference**: 각 화면(Dashboard, Portfolio, Impact Map 등)의 레이아웃 및 내비게이션 구조를 참조함.\n- **Interaction**: 버튼 호버 효과, 상태 변화(Loading/Success), 트랜잭션 진행 표시 등의 인터랙션을 확인하는 용도로 사용함.\n\n---\n\n## X. Related Documents\n- **Foundation**: [UI Design](../01_Foundation/05_UI_DESIGN.md) - 디자인 시스템 가이드라인\n- **Foundation**: [Branding Plan](../01_Foundation/02_BRANDING_PLAN.md) - 현재 반영된 브랜딩 명칭 규칙\n- **Specs**: [Admin Portal Spec](../03_Specs/03_ADMIN_PORTAL_SPEC.md) - UI 컴포넌트 기술 명세 참조\n"
  },
  {
    "source": "03_Specs/01_INFRASTRUCTURE.md",
    "content": "# 인프라 및 개발 환경 (Infrastructure & Environment)\n> Created: 2026-01-24 23:38\n> Last Updated: 2026-02-09\n\n본 문서는 BondBase 프로젝트의 네트워크 설정, 외부 서비스 엔드포인트 및 배포 환경에 대한 최신 정보를 관리합니다.\n\n## 1. Blockchain Network (Creditcoin 3.0)\n\n현재 스마트 컨트랙트 배포 및 테스트를 위해 **Creditcoin 3.0 (CC3) Testnet**을 사용합니다.\n\n- **Network Name**: `creditcoin-testnet`\n- **RPC URL**: `https://rpc.cc3-testnet.creditcoin.network`\n- **Chain ID**: `102031`\n- **Currency**: `CTC` (Testnet)\n- **Explorer**: [Creditcoin Explorer](https://explorer.creditcoin.org)\n- **Primary Wallet Address**: `0xf42138298fa1Fc8514BC17D59eBB451AceF3cDBa`\n- **Contract Environment**: Hardhat / Foundry (EVM Compatible)\n\n## 2. Database & Storage\n\n데이터 무결성 및 고성능 조회를 위해 하이브리드 저장 구조를 사용합니다.\n\n- **Primary Database**: Turso (libSQL/SQLite)\n- **ORM**: Drizzle ORM\n- **Media Storage**: Cloudinary (이미지 및 영상 자산 호스팅)\n- **Vector Search**: Turso Vector Search (RAG 시스템용)\n\n## 3. Backend & API Services\n\n- **Runtime**: Node.js 18+ (TypeScript)\n- **Hosting**: Vercel (Node.js Edge Runtime 또는 API Routes)\n- **Authentication**: Better Auth (Session-based)\n- **Oracle**: Creditcoin Universal Oracle (실물 자산 데이터 연동용)\n\n## 4. Tokenomics (Choonsim Growth Model)\n\n춘심 프로젝트의 지속 가능성과 경제적 안정을 위해 다음 세 가지 자산이 상호 보완적으로 작동합니다.\n\n- **Native Coin (CTC)**: Creditcoin 네트워크의 연료입니다. 모든 트랜잭션 수수료(Gas Fee)를 지불하는 데 사용되며, 네트워크의 보안과 처리 속도를 보장합니다.\n- **ERC-1155 (ChoonsimBond)**: 단순한 코인이 아닌 '특정한 권리'가 담긴 증서입니다. 춘심이의 성장에 대한 수익권(Revenue Share Right)과 거버넌스 투표권, 한정판 대화 권한 등을 포함하는 다기능 토큰으로, 각 마일스톤이나 자산 등급별로 세밀하게 발행됩니다.\n- **ERC-20 (MockUSDC)**: 실제 경제 활동의 척도가 되는 스테이블코인입니다. CTC의 가격 변동성에 영향받지 않고, 투자자가 투입한 금액과 돌려받을 배당금(Yield)을 안정적인 법정화폐 가치에 고정하여 지급하기 위한 기초 통화로 활용됩니다.\n\n## 5. Frontend Environment\n\n- **Framework**: React Router v7 (Vite)\n- **Styling**: Tailwind CSS v4\n- **Date/Time Standard**: **Luxon** (Asia/Seoul 기준 우선 처리)\n- **Hosting**: Vercel\n\n## 6. Deployment Status (Current)\n\n| Module | Env | Status | Last Deployment |\n| :--- | :--- | :--- | :--- |\n| Smart Contracts | Testnet | Active (v3) | 2026-02-09 |\n| Dashboard App | Dev | Active | 2026-01-24 |\n| RAG Engine | Dev | Integrated | 2026-01-24 |\n\n## 7. V3 Contract Addresses (Creditcoin Testnet)\n\n| Contract | Address | 비고 |\n| :--- | :--- | :--- |\n| MockUSDC (V3) | `0x03E7d375e76A105784BFF5867f608541e89D311B` | 프론트/릴레이어 기본 USDC |\n| BondToken (V3) | `0x01607c3Ff57e3234702f55156E4356e3036f8D4E` | ERC-1155 |\n| YieldDistributor (V3) | `0x0D38d19dA1dC7F018d9B31963860A39329bf6974` | Bond 101 등록·DISTRIBUTOR_ROLE 설정 완료 |\n| LiquidityPool (V3) | `0xC86F94d895331855C9ac7E43a9d96cf285512B31` | |\n| OracleAdapter (V3) | `0xDaD165Ba828bD90f0e4897D92005bb1660f4785f` | 선택 B 적용, V3 YD + V3 MockUSDC |\n\n완료 항목·잔여 작업·OracleAdapter 선택 A/B는 [05_V3_DEPLOYMENT_STATUS.md](./05_V3_DEPLOYMENT_STATUS.md) 참조.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](../01_Foundation/00_PROJECT_OVERVIEW.md) - 전체 프로젝트 비전\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 개발 단계 로드맵\n- **Specs**: [Revenue Bridge Spec](./02_REVENUE_BRIDGE_SPEC.md) - 수익 연동 API 명세\n- **Specs**: [V3 배포 완료 항목 및 잔여 작업](./05_V3_DEPLOYMENT_STATUS.md) - 완료/잔여 체크리스트, OracleAdapter 선택\n"
  },
  {
    "source": "03_Specs/02_REVENUE_BRIDGE_SPEC.md",
    "content": "# 춘심톡 → BondBase Revenue Bridge 연동 스펙\n> Created: 2026-02-01 16:33\n> Last Updated: 2026-02-13 (Post-Phase 3 Stabilization)\n\n**대상**: 춘심톡 백엔드 개발팀\n**목적**: 춘심톡에서 BondBase `api/revenue`를 호출할 때 준수해야 할 규칙과 데이터 규격을 정의합니다.\n\n## 1. 연동 개요\n\n춘심톡에서 발생하는 매출(구독), 마일스톤 달성, 지표 변화(팔로워 등) 이벤트를 BondBase API에 전송합니다. 전송된 데이터는 BondBase 채권 투자자의 수익 배당 및 대시보드 시각화에 사용됩니다.\n\n```\n춘심톡 백엔드 (IP Owner)\n    │\n    │  POST /api/revenue (HTTPS, Bearer Token)\n    ▼\nBondBase API (Vercel)\n    │\n    ├─ DB (Turso) 기록 및 대시보드 반영\n    │\n    └─ Relayer (Batch Process) ──→ Creditcoin Testnet (온체인 배당)\n```\n\n## 2. 인터페이스 사양\n\n### 2.1 공통 호출 규격\n| 항목 | 값 |\n|------|-----|\n| Method | `POST` |\n| URL | `https://{BONDBASE_DOMAIN}/api/revenue` |\n| Content-Type | `application/json` |\n| Authorization | `Bearer {CHOONSIM_API_KEY}` |\n\n### 2.2 전송 데이터 타입 (Payload)\n\n모든 요청은 `type` 필드로 구분되는 **Discriminated Union** 구조를 가집니다.\n\n#### (A) REVENUE — 실제 매출 발생 시\n실제 수익 배당의 근거가 되는 데이터입니다.\n```json\n{\n  \"type\": \"REVENUE\",\n  \"data\": {\n    \"amount\": \"150.50\",\n    \"source\": \"SUBSCRIPTION\",\n    \"description\": \"2026-02 월간 구독료 총액\"\n  }\n}\n```\n*   **amount (필수)**: USDC 기준 금액 (숫자 형태의 문자열).\n    *   범위: 0.01 ~ 1,000,000\n    *   소수점 2자리 권장.\n*   **source (필수)**: 매출 출처 (예: \"SUBSCRIPTION\", \"SUPERCHAT\", \"MD_SALES\").\n    *   `\"SUBSCRIPTION\"`인 경우 시스템 내 활성 구독자 수가 자동으로 1 증가합니다.\n*   **description (필수)**: 매출에 대한 설명.\n\n#### (B) MILESTONE — 보너스 배당 이벤트 발생 시\n특정 목표 달성 시 투자자에게 추가 보너스를 지급할 때 사용합니다.\n```json\n{\n  \"type\": \"MILESTONE\",\n  \"data\": {\n    \"key\": \"GLOBAL_65K\",\n    \"description\": \"글로벌 팔로워 65,000명 돌파 기념 보너스\",\n    \"achievedAt\": 1739445000000,\n    \"bonusAmount\": \"50.00\"\n  }\n}\n```\n*   **key (필수)**: 중복 처리 방지를 위한 고유 키.\n*   **bonusAmount (선택)**: 해당 마일스톤 달성 시 투자자에게 즉시 배당할 보너스 금액(USDC).\n\n#### (C) METRICS — 성장 지표 업데이트 (시각화용)\n대시보드의 차트 및 지역별 파이 차트를 업데이트합니다.\n```json\n{\n  \"type\": \"METRICS\",\n  \"data\": {\n    \"followers\": 65000,\n    \"subscribers\": 1200,\n    \"shares\": {\n      \"southAmerica\": 75,\n      \"japan\": 20,\n      \"other\": 5\n    }\n  }\n}\n```\n*   **followers/subscribers**: 정수형 (0 이상의 값).\n*   **shares**: 지역별 비중 (합계 100 기준 권장).\n\n## 3. 응답 규격\n\n### 3.1 성공 (200 OK)\n```json\n{ \"success\": true }\n```\n\n### 3.2 요청 오류 (400 Bad Request)\n유효성 검사 실패 시 상세 에러가 반환됩니다.\n```json\n{\n  \"success\": false,\n  \"error\": \"Invalid request\",\n  \"details\": {\n    \"fieldErrors\": {\n      \"data.amount\": [\"amount must be a non-negative number string\"]\n    }\n  }\n}\n```\n\n### 3.3 인증 오류 (401 Unauthorized)\n`Authorization` 헤더가 잘못되었거나 API Key가 만료된 경우입니다.\n\n## 4. 보안 및 오라클 검증 (Audit)\n\n1.  **API Key 보안**: 발급된 `CHOONSIM_API_KEY`는 서버 간 통신에만 사용하며 클라이언트(App/Web) 코드에 노출되지 않도록 주의하십시오.\n2.  **데이터 무결성**: 전송된 `amount`는 향후 오라클 노드에 의해 PG사(Stripe 등)의 수취 내역과 대조 검증될 수 있습니다. 실제 정산 시점의 수치와 일치해야 합니다.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 연동 단계 로드맵\n- **Specs**: [Infrastructure Specs](./01_INFRASTRUCTURE.md) - 네트워크 및 환경 설정\n- **Specs**: [Multi-Character Bond Spec](./07_MULTI_CHARACTER_BOND_SPEC.md) - 다중 캐릭터( bondId/characterId ) API 확장 및 DB 스키마\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 오라클 데이터 검증 로직 상세\n- **Test**: [QA Checklist](../05_Test/02_QA_CHECKLIST.md) - 연동 후 테스트 항목\n"
  },
  {
    "source": "03_Specs/03_ADMIN_PORTAL_SPEC.md",
    "content": "# Admin Portal Specification: Yield Distribution Management\n> Created: 2026-01-16 10:48\n> Last Updated: 2026-02-09\n\n## 1. 개요 (Overview)\n본 문서는 BondBase 프로젝트의 안전하고 효율적인 운영을 위한 **관리자 전용 포털(Admin Portal)**의 설계 사양을 정의합니다. 기존의 블록 익스플로러를 통한 수동 운영 방식에서 탈피하여, 웹 인터페이스 내에서 직관적이고 오류 없는 자산 운영 환경을 구축하는 것을 목적으로 합니다.\n\n> **구현 현황**: Admin Portal은 별도 애플리케이션이 아닌, 메인 프론트엔드(`frontend/app/routes/admin.tsx`) 내 **통합 라우트(`/admin`)**로 구현되어 있습니다. `DISTRIBUTOR_ROLE` 기반 접근 제어를 통해 관리자만 접근 가능합니다.\n\n## 2. 핵심 목표 (Goal)\n- **보안성**: 브라우저 보안 경고 없이 신뢰할 수 있는 환경에서 트랜잭션 실행.\n- **편의성**: 복잡한 소수점 변환 및 중복 트랜잭션(`Approve` → `Deposit`) 자동화.\n- **정확성**: 실시간 잔액 조회를 통한 입금 실패 방지.\n\n## 3. 핵심 기능 요구사항 (Core Requirements)\n\n### 3.1 지갑 연결 및 권한 검증\n- **Wallet Connection**: WalletConnect, MetaMask 연동.\n- **Access Control**: `DISTRIBUTOR_ROLE` 보유 여부 검증 및 인터페이스 제어.\n\n### 3.2 스마트 수익 배분 모듈 (Smart Yield Distribution)\n- **Step-by-Step Flow**:\n    1. 관리자가 달러 단위(USDC)로 금액 입력.\n    2. `Allowance` 자동 조회 후 `Approve` 필요 여부 판단.\n    3. 단일 UI 액션으로 `Approve` → `Deposit` 멀티 트랜잭션 가이드 제공.\n- **Unit Conversion**: `parseUnits(amount, 18)` 내부 자동 처리.\n\n### 3.3 대시보드 모니터링\n- **관리자 잔액**: 보유 `MockUSDC` 수량 상시 노출.\n- **글로벌 보상 상태**: `rewardPerTokenStored` 기반 총 배분 결과 현황 시각화.\n\n## 4. 기술 스택\n- **Frontend**: React Router v7 (Vite) - 메인 대시보드 내 `/admin` 라우트로 통합 구현\n- **Styling**: Tailwind CSS v4, shadcn/ui\n- **On-chain**: `wagmi` (v3), `viem` (v2)\n- **주요 컴포넌트**: `yield-deposit-module.tsx`, `oracle-trigger-module.tsx`, `advanced-oracle-module.tsx`\n\n---\n\n## X. Related Documents\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 어드민 포털 개발 로드맵 포함\n- **Specs**: [Infrastructure Specs](./01_INFRASTRUCTURE.md) - 스마트 컨트랙트 및 네트워크 정보\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 배분 대장 기록 로직\n"
  },
  {
    "source": "03_Specs/04_TECHNICAL_ARCHIVE.md",
    "content": "# 아이디어톤 기술 대응 아카이브 (Technical Q&A)\n> Created: 2026-01-25 10:00\n> Last Updated: 2026-02-09 04:18\n\n## 1. 스마트 컨트랙트 아키텍처\n- **Token Standard**: ERC-1155를 사용하여 단일 컨트랙트에서 다수의 IP 채권을 효율적으로 관리.\n- **RBAC**: `YieldDistributor` 컨트랙트가 `BondToken`의 `MINTER_ROLE`을 보유하여 정교한 재투자(Reinvest) 로직 수행.\n- **Stability Engine**: USDC 페깅 정산을 통해 자산 가치 변동성 최소화.\n\n## 2. 데이터 무결성 및 오라클\n- **Problem**: 오프체인의 실물 매출 데이터를 블록체인이 어떻게 신뢰하는가?\n- **Solution**: \n    1. **Dual Verification Loop**: 매출 API 데이터와 온체인 이벤트의 상호 검증.\n    2. **Audit Logic**: `auditRevenue` 함수를 통해 검증된 매출만 정산금으로 확정. \n    3. **Transparency**: 모든 정산 이력은 Creditcoin Scan을 통해 투명하게 공개.\n\n## 3. 예상 기술 Q&A\n- **Q: IP 가치가 하락하면 어떻게 되는가?**\n  - A: 본 모델은 단순 소유권이 아닌 '발생 매출 기반 수익권'에 집중함. 팬덤 활동(구독, MD 등)이 있는 한 매출은 발생하며, USDC 기반 정산으로 안정적 유동성 확보.\n- **Q: Creditcoin 3.0을 선택한 이유는?**\n  - A: RWA 전문 L1으로서의 보안성, 낮은 가스비, Universal Oracle 인프라가 데이터 신뢰도 확보에 최적화됨.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Submission Spec](../01_Foundation/07_SUBMISSION_SPEC.md) - 프로젝트 전체 비전 및 키워드\n- **Specs**: [Infrastructure Specs](./01_INFRASTRUCTURE.md) - 네트워크 및 기술 스택\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 상세 데이터 검증 알고리즘\n"
  },
  {
    "source": "03_Specs/05_V3_DEPLOYMENT_STATUS.md",
    "content": "# V3 배포 완료 항목 및 잔여 작업 (V3 Deployment Status & Checklist)\n> Created: 2026-01-23\n> Last Updated: 2026-01-23 (Choice B 및 Pausable ABI 반영)\n\n본 문서는 Creditcoin Testnet 기준 **V3 스마트 컨트랙트 배포** 이후 완료된 설정과, 선택·잔여 작업을 명시합니다. 문서 계층 규칙(AGENTS.md 5-Layer Structure)에 따라 **03_Specs**에 배치하며, 인프라 명세(01_INFRASTRUCTURE.md)와 함께 참조합니다.\n\n---\n\n## 1. 완료된 내용 (Completed)\n\n### 1.1 V3 컨트랙트 배포\n- **MockUSDC (V3)**: `0x03E7d375e76A105784BFF5867f608541e89D311B`\n- **BondToken (V3)**: `0x01607c3Ff57e3234702f55156E4356e3036f8D4E`\n- **YieldDistributor (V3)**: `0x0D38d19dA1dC7F018d9B31963860A39329bf6974`\n- **LiquidityPool (V3)**: `0xC86F94d895331855C9ac7E43a9d96cf285512B31`\n- 배포 스크립트: `contracts/scripts/redeploy_v3.ts` (setBondToken 등 Creditcoin testnet calldata 이슈 대응 반영)\n\n### 1.2 OracleAdapter (선택 B 적용 완료)\n- **V3 전용 OracleAdapter**: `0xDaD165Ba828bD90f0e4897D92005bb1660f4785f` 신규 배포\n- 생성자: V3 YieldDistributor + V3 MockUSDC 사용. 프론트·릴레이어·YD가 동일한 V3 MockUSDC 기준으로 동작함.\n- `YieldDistributor.grantRole(DISTRIBUTOR_ROLE, 신규 OracleAdapter)` 실행 완료.\n- `OracleAdapter.grantRole(ORACLE_ROLE, deployer)` 실행 완료.\n- 배포 스크립트: `contracts/scripts/deploy-oracle-adapter-v3.ts`\n\n### 1.3 YieldDistributor 사후 설정\n- `YieldDistributor.grantRole(DISTRIBUTOR_ROLE, OracleAdapter)` 실행 완료 (기존 OA 후, 선택 B로 신규 OA에도 부여 완료)\n- `YieldDistributor.registerBond(101)` 실행 완료 (Choonsim Bond ID 101)\n- `YieldDistributor.setAuditRequirement(101, true)` 실행 완료\n- 실행 스크립트: `contracts/scripts/setup-v3-post-deploy.ts` (Creditcoin testnet에서 calldata 유지를 위해 `ethers.Wallet` + `signTransaction` / `broadcastTransaction` 사용)\n\n### 1.4 프론트엔드·릴레이어·문서 주소 갱신\n- **frontend/app/config/contracts.ts**: MockUSDC, BondToken, LiquidityPool, YieldDistributor, **OracleAdapter(V3)** 주소 반영. LiquidityPool·YieldDistributor ABI에 **pause, unpause, paused** 추가 완료.\n- **relayer/src/config.ts**: `MOCK_USDC_ADDRESS` V3, `ORACLE_ADAPTER_ADDRESS` 신규 V3 OracleAdapter(`0xDaD165...`) 반영\n- **docs/03_Specs/01_INFRASTRUCTURE.md**: V3 계약 주소 표 갱신\n\n---\n\n## 2. 해야 할 내용 (Remaining / Optional)\n\n- **OracleAdapter**: 선택 B 적용 완료. 신규 V3 OracleAdapter 배포 및 주소 갱신 완료.\n- **USDC 정합성**: 선택 B로 V3 MockUSDC 일원화 완료. 별도 조치 없음.\n- **ABI (Pausable)**: `frontend/app/config/contracts.ts`에 LiquidityPool·YieldDistributor용 **pause**, **unpause**, **paused** 추가 완료.\n- 현재 컨트랙트 관련 잔여 작업 없음.\n\n<!-- 이전 선택 A/B 표 및 권장 순서는 Choice B 적용으로 위 요약으로 대체함 -->\n\n### 2.1 (참고) OracleAdapter 선택 A/B\n| 선택 | 설명 | 조치 |\n|------|------|------|\n| **A (현재)** | 기존 OracleAdapter 사용. YD만 V3로 연결, USDC는 Oracle 흐름에서 **구 MockUSDC** 사용 | 추가 조치 없음. Oracle이 depositYield 할 때 구 MockUSDC 사용 필요함을 문서·릴레이어에서 유지 |\n| **B** | V3 체인과 완전 일치 | OracleAdapter를 **신규 배포**(신규 YD + 신규 MockUSDC) → relayer `ORACLE_ADAPTER_ADDRESS` 갱신 → 신규 YD에서 `grantRole(DISTRIBUTOR_ROLE, 신규 OracleAdapter)` 실행 |\n\n### 2.2 선택 A 시 USDC 정합성\n- OracleAdapter 내부 `usdcToken`은 구 MockUSDC이므로, Relayer가 yield 푸시 시 **구 MockUSDC**를 사용해야 depositYield가 정상 동작함.\n- 현재 relayer `MOCK_USDC_ADDRESS`는 V3 주소로 되어 있음. 선택 A를 유지하면서 Oracle 전용으로 구 MockUSDC 주소가 필요하면, 설정 분리(예: `ORACLE_USDC_ADDRESS`) 또는 문서에 “Oracle용 USDC = 구 MockUSDC” 명시 권장.\n\n### 2.3 ABI (선택)\n- Admin UI에서 **LiquidityPool / YieldDistributor**의 일시정지·재개를 사용할 계획이면, `frontend/app/config/contracts.ts`의 해당 컨트랙트 ABI에 **pause**, **unpause**, **paused** 항목을 추가하는 것이 좋음.\n\n---\n\n## 3. (참고) 권장 순서 (Choice B 적용으로 위 2절 요약 참고)\n\n1. **OracleAdapter 정책 확정**: 선택 A 유지 vs 선택 B(신규 배포 후 relayer·YD 설정)\n2. **선택 A 유지 시**: Oracle depositYield 흐름용 USDC 주소(구 MockUSDC)를 relayer 또는 문서에 명시\n3. **선택 B 진행 시**: OracleAdapter 신규 배포 → relayer `ORACLE_ADAPTER_ADDRESS` 갱신 → `setup-v3-post-deploy.ts`와 동일한 방식으로 신규 YD에 `grantRole(DISTRIBUTOR_ROLE, 신규 OracleAdapter)` 실행\n4. **ABI**: Admin에서 pause/unpause 사용 예정이면 `contracts.ts`에 Pausable 함수 추가\n\n---\n\n## 4. 참고: 사후 설정 스크립트\n\n### 4.1 기존 V3 연동·Bond 101 (이미 실행된 경우 스킵)\n```bash\ncd contracts\nnpx hardhat run scripts/setup-v3-post-deploy.ts --network creditcoin-testnet\n```\n\n- `PRIVATE_KEY` 환경 변수 필요 (YieldDistributor 트랜잭션 서명용)\n- OracleAdapter setYieldDistributor, YD grantRole, registerBond(101), setAuditRequirement(101, true). 이미 완료된 항목은 스크립트 내에서 “Already set. Skip.” 등으로 스킵됨\n\n### 4.2 V3 전용 OracleAdapter 신규 배포 (Choice B, 1회 실행 완료)\n```bash\ncd contracts\nnpx hardhat run scripts/deploy-oracle-adapter-v3.ts --network creditcoin-testnet\n```\n- 출력된 `NEW_ORACLE_ADAPTER_ADDRESS`를 frontend/relayer 설정에 반영 (본 배포에서 이미 반영됨: `0xDaD165Ba828bD90f0e4897D92005bb1660f4785f`)\n\n---\n\n## X. Related Documents\n- **Specs**: [인프라 및 개발 환경](./01_INFRASTRUCTURE.md) - 네트워크, 배포 환경, V3 계약 주소 요약\n- **Logic**: [코드 품질 개선 구현 계획](../04_Logic/02_QUALITY_IMPROVEMENT_PLAN.md) - Phase 3 컨트랙트 강화 및 배포 계획\n- **Foundation**: [로드맵](../01_Foundation/03_ROADMAP.md) - 개발 단계 로드맵\n"
  },
  {
    "source": "03_Specs/06_RELAYER_OPS.md",
    "content": "# Relayer 운영 가이드 (Operation Specs)\n> Created: 2026-02-13\n> Last Updated: 2026-02-13\n\nBondBase Relayer 배포, 모니터링, 장애 대응을 위한 기술 명세입니다. 문서 계층 규칙(AGENTS.md 5-Layer)에 따라 **03_Specs**에 배치합니다.\n\n## 1. 개요\nBondBase Relayer는 오프체인(핀테크 수익 데이터)과 온체인(스마트 컨트랙트) 간의 데이터를 동기화하는 핵심 인프라입니다.\n주기적으로 `MockFintechAPI`를 조회하여 수익이 발생하면 `OracleAdapter` 컨트랙트를 통해 온체인 상태를 업데이트합니다.\n\n## 2. 실행 환경\n- **Runtime**: Node.js v18+\n- **Package Manager**: npm (v7+ workspaces)\n- **Framework**: TypeScript (tsx execution)\n\n### 2.1 실행 방법\n루트 디렉토리에서 다음 명령어를 실행합니다.\n\n```bash\n# 개발 모드 (Pretty Logs)\nnpm run start --workspace=relayer\n\n# 프로덕션 모드 (JSON Logs)\nNODE_ENV=production npm run start --workspace=relayer\n```\n\n## 3. 환경 변수 (.env)\nRelayer 실행을 위해 `relayer/.env` 파일이 필요합니다.\n\n| 변수명 | 필수 | 설명 | 예시 |\n| :--- | :---: | :--- | :--- |\n| `PRIVATE_KEY` | O | Relayer 지갑의 개인키 (0x 제외) | `abcdef...` |\n| `RPC_URL` | O | Creditcoin Testnet RPC URL | `https://rpc.cc3-testnet...` |\n| `ORACLE_ADAPTER_ADDRESS` | O | OracleAdapter 컨트랙트 주소 | `0x123...` |\n| `MOCK_USDC_ADDRESS` | O | MockUSDC 컨트랙트 주소 | `0x456...` |\n| `SYNC_INTERVAL_MS` | X | 동기화 주기 (밀리초, 기본값: 60000) | `30000` |\n| `LOG_LEVEL` | X | 로그 레벨 (debug, info, warn, error) | `info` |\n\n## 4. 모니터링 및 로깅\nRelayer는 `pino` 로거를 사용하여 구조화된 로그를 출력합니다.\n\n### 4.1 로그 포맷\n- **Development**: 사람이 읽기 쉬운 컬러 포맷 (`pino-pretty`)\n- **Production**: 기계가 파싱하기 쉬운 JSON 라인 포맷 (ELK 스택, CloudWatch 연동 용이)\n\n### 4.2 주요 로그 이벤트\n| 레벨 | 메시지 예시 | 설명 |\n| :--- | :--- | :--- |\n| `INFO` | `[Bond #101] Delta detected: 250.0 USDC` | 오프체인 수익 증가 감지 |\n| `INFO` | `[Bond #101] Sync OK. Tx: 0x...` | 온체인 업데이트 성공 |\n| `WARN` | `[Recovery] Consecutive failures: 3` | 연속 실패 발생 (백오프 진입) |\n| `ERROR` | `[FATAL] PRIVATE_KEY not found` | 치명적 오류 (프로세스 종료) |\n\n## 5. 장애 대응 (Troubleshooting)\n\n### 5.1 연속 실패 (Consecutive Failures)\nRelayer는 RPC 연결 실패나 트랜잭션 오류 시 **Exponential Backoff** (지수 백오프) 전략을 사용하여 재시도합니다.\n- 3회 연속 실패 시 RPC Provider를 자동으로 재연결합니다.\n- 최대 8배수까지 대기 시간이 늘어납니다.\n\n**조치 방법:**\n1. 로그에서 `[Recovery]` 메시지 확인.\n2. `RPC_URL` 상태 점검 (네트워크 장애 여부).\n3. Relayer 지갑의 가스비(CTC) 잔액 확인.\n\n### 5.2 트랜잭션 지연 (Stuck Transaction)\nNonce가 꼬이거나 가스비 급등으로 트랜잭션이 펜딩될 수 있습니다. (현재는 자동 Gas Price 조정 로직 미포함)\n\n**조치 방법:**\n1. Explorer에서 해당 지갑의 Pending 트랜잭션 확인.\n2. Relayer 재시작 (메모리 상태 초기화).\n3. 필요 시 동일 Nonce로 더 높은 가스비를 설정한 빈 트랜잭션 전송 (수동).\n\n## 6. 배포 체크리스트\n- [ ] `.env` 파일의 `PRIVATE_KEY`가 운영용 지갑인지 확인.\n- [ ] `ORACLE_ADAPTER_ADDRESS`가 최신 배포된 컨트랙트인지 확인.\n- [ ] `NODE_ENV=production` 설정 확인.\n- [ ] 프로세스 관리 도구(PM2, Docker 등) 설정 여부. (추후 도입 예정)\n\n---\n\n## X. Related Documents\n- **Specs**: [인프라 및 개발 환경](./01_INFRASTRUCTURE.md) - RPC, V3 계약 주소\n- **Specs**: [V3 배포 완료 항목 및 잔여 작업](./05_V3_DEPLOYMENT_STATUS.md) - OracleAdapter 주소 및 설정\n- **Logic**: [프로젝트 작업 백로그](../04_Logic/00_BACKLOG.md) - 감사 이슈 처리 현황\n- **Test**: [코드 품질 감사 보고서](../05_Test/04_CODE_QUALITY_AUDIT.md) - 감사 9.2\n"
  },
  {
    "source": "03_Specs/07_MULTI_CHARACTER_BOND_SPEC.md",
    "content": "# 다중 캐릭터(채권) 연동 스펙 — API bondId 확장 및 DB 스키마\n> Created: 2026-01-23\n> Last Updated: 2026-01-23\n\n**대상**: BondBase 개발팀, 춘심톡 백엔드 개발팀\n**목적**: 춘심톡 내 여러 캐릭터별로 채권(bondId)을 구분하여 수익·지표를 기록하고 온체인 배당을 지원하기 위한 API 확장 및 DB 변경 포인트를 정의합니다. 기존 [Revenue Bridge Spec](./02_REVENUE_BRIDGE_SPEC.md)을 확장합니다.\n\n---\n\n## 1. 연동 개요\n\n- **현재**: 단일 캐릭터(춘심) = 단일 bondId(101). `POST /api/revenue`는 bondId 없이 호출되며, 모든 수익이 bond 101에 연결됩니다.\n- **목표**: 캐릭터 1명 = 온체인 bondId 1개. API 요청에 `bondId`(또는 `characterId`)를 포함하여, 캐릭터별로 수익·마일스톤·메트릭스를 구분 저장 및 배당합니다.\n\n```\n춘심톡 백엔드 (캐릭터 A, B, C …)\n    │\n    │  POST /api/revenue  { \"bondId\": 101 | 102 | 103, \"type\": \"REVENUE\", \"data\": { … } }\n    ▼\nBondBase API (Vercel)\n    │\n    ├─ DB (Turso) — 캐릭터(project)별 revenue / milestone / metrics\n    │\n    └─ Relayer — bondId별 depositYield(bondId, amount) → Creditcoin Testnet\n```\n\n---\n\n## 2. API 확장 사양\n\n### 2.1 공통: Payload에 bondId 추가\n\n모든 `POST /api/revenue` 요청 본문에 **최상위 필드**로 다음 중 하나를 사용합니다.\n\n| 필드명 | 타입 | 필수 | 설명 |\n|--------|------|------|------|\n| `bondId` | number (정수) | 권장 | 온체인 채권 ID. 101, 102, 103 … |\n| `characterId` | string | 선택 | 캐릭터 식별자. 서버에서 bondId와 매핑 테이블로 연결 가능. |\n\n- **권장**: 온체인과 1:1 대응이 명확하므로 **`bondId`** 사용.\n- **호환**: 구현 1단계에서 `bondId` 생략 시 기존과 동일하게 **101**로 처리(하위 호환).\n\n### 2.2 REVENUE 페이로드 예시 (bondId 포함)\n\n```json\n{\n  \"bondId\": 102,\n  \"type\": \"REVENUE\",\n  \"data\": {\n    \"amount\": \"150.50\",\n    \"source\": \"SUBSCRIPTION\",\n    \"description\": \"캐릭터 B 2026-02 월간 구독료\"\n  }\n}\n```\n\n- 동일하게 **MILESTONE**, **METRICS** 타입에도 최상위에 `bondId`(또는 `characterId`)를 둡니다.\n\n### 2.3 검증 규칙 (Zod 등)\n\n- `bondId`: `z.number().int().positive()` (또는 허용 목록에 있는지 화이트리스트 검증 권장).\n- `characterId`: `z.string().min(1).optional()`. 사용 시 서버에서 `characterId → bondId` 매핑 테이블/설정으로 변환.\n- **생략 시**: `bondId` 없음 → 기본값 101 적용(기존 단일 캐릭터 동작).\n\n### 2.4 응답 및 에러\n\n- **400**: `bondId`가 허용 목록에 없거나, 타입/범위 오류.\n- **404**: 해당 `bondId`에 대한 프로젝트가 DB에 없고, 자동 생성도 하지 않는 정책인 경우(선택 사항).\n- 성공 시 응답 형식은 기존과 동일: `{ \"success\": true }`.\n\n---\n\n## 3. DB 스키마 변경 포인트\n\n현재 Choonsim 연동용 테이블: `choonsim_projects`, `choonsim_revenue`, `choonsim_milestones`, `choonsim_metrics_history`.  \n캐릭터(채권) 구분을 위해 아래만 변경하면 됩니다.\n\n### 3.1 `choonsim_projects`\n\n| 변경 | 내용 |\n|------|------|\n| **추가 컬럼** | `bond_id` integer UNIQUE NULLABLE |\n| **의미** | 온체인 bondId와 1:1 대응. 한 프로젝트 = 한 캐릭터 = 한 bondId. |\n| **마이그레이션** | 기존 단일 행(예: id=`choonsim-main`)에 `bond_id = 101` 설정. |\n| **신규 캐릭터** | 새 행 추가 시 `id`(예: `bond-102`), `bond_id = 102` 등으로 저장. |\n\n- **조회**: API에서 `bondId` 수신 시 `bond_id = ?` 로 프로젝트 조회. 없으면 정책에 따라 생성 또는 404.\n\n### 3.2 `choonsim_revenue`, `choonsim_milestones`, `choonsim_metrics_history`\n\n| 테이블 | 변경 | 비고 |\n|--------|------|------|\n| `choonsim_revenue` | 변경 없음 | 기존 `project_id`로 캐릭터(프로젝트) 구분. 프로젝트를 bondId별로 나누면 자동으로 캐릭터별 수익 구분됨. |\n| `choonsim_milestones` | 변경 없음 | 동일하게 `project_id`로 구분. |\n| `choonsim_metrics_history` | 변경 없음 | 동일하게 `project_id`로 구분. |\n\n- 즉, **프로젝트 = 캐릭터 = bondId** 로 두고, 기존 `project_id` FK만 유지하면 됨. 별도 테이블에 `bond_id`를 중복 저장할 필요는 없음(선택 사항).\n\n### 3.3 (선택) characterId → bondId 매핑\n\n춘심톡에서 `characterId`(문자열)만 보내고 bondId는 BondBase가 매핑하는 경우:\n\n- **방안 A**: `choonsim_projects`에 `character_id` text 컬럼 추가. UNIQUE. API에서 `characterId`로 조회 후 해당 행의 `bond_id` 사용.\n- **방안 B**: 설정 파일/환경변수로 `CHARACTER_BOND_MAP={\"char-a\":101,\"char-b\":102}` 형태 유지. DB 변경 없음.\n\n---\n\n## 4. Relayer·프론트 연동 요약\n\n- **Relayer**: `BOND_IDS`를 `[101, 102, 103, …]` 로 확장. 캐릭터별 수익 데이터를 해당 bondId로 `updateAssetStatus(bondId, …)` 호출(이미 bondId 단위이므로 로직 확장만 필요).\n- **프론트**: Growth Market 등에서 채권 목록을 bond 101, 102, 103 … 로 확장. 기존 bondId 기준 투자/수익 조회는 그대로 사용 가능.\n- **온체인**: 새 캐릭터 추가 시 해당 bondId에 대해 `registerBond(bondId)` 실행 및 필요 시 BondToken URI 설정.\n\n---\n\n## 5. 구현 순서 제안\n\n1. **DB**: `choonsim_projects`에 `bond_id` 추가 및 기존 행에 101 설정. (백업 후 마이그레이션.)\n2. **API**: `api.revenue`에 `bondId`(선택) 파싱·검증 추가. 생략 시 101. `bondId`로 프로젝트 조회/생성 후 기존대로 revenue/milestone/metrics 저장 및 `relayDepositYield(bondId, amount)` 호출.\n3. **Relayer**: `BOND_IDS` 및 캐릭터별 데이터 소스 확장.\n4. **프론트**: 채권 목록에 다중 bondId 반영.\n5. **(선택)** `characterId` 지원 시 매핑 테이블 또는 설정 도입.\n\n---\n\n## X. Related Documents\n\n- **Specs**: [Revenue Bridge Spec](./02_REVENUE_BRIDGE_SPEC.md) - 단일 캐릭터 기준 API 규격 (본 문서가 확장)\n- **Specs**: [Infrastructure](./01_INFRASTRUCTURE.md) - 네트워크 및 V3 계약 주소\n- **Logic**: [Backlog](../04_Logic/00_BACKLOG.md) - 다중 채권 관리 기능 항목\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 연동 단계\n"
  },
  {
    "source": "04_Logic/00_BACKLOG.md",
    "content": "# 프로젝트 작업 백로그 (Backlog)\n> Created: 2026-02-01 15:14\n> Last Updated: 2026-02-13\n\n## 1. 현재 진행 상황 (Kanban)\n\n### 🔴 Todo (할 일)\n\n#### 높음 (High)\n- (현재 High 우선순위 항목 없음)\n\n#### 중간 (Medium)\n\n\n\n\n#### 낮음 (Low) / 장기\n- [ ] **[컨트랙트 UUPS 업그레이드]** 메인넷 전환 시 검토. → [감사 P3 6.3](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [ ] **[Relayer 모니터링 체계]** 구조화 로깅(Pino), 연속 실패 알림(Slack webhook), 메트릭 수집. 운영 인프라 결정 후 진행. → [감사 P3 6.6](../05_Test/04_CODE_QUALITY_AUDIT.md)\n#### 기능 개발 (Feature)\n- [ ] 춘심톡 백엔드 실제 `api/revenue` 호출 모듈 개발 지원\n- [ ] 오라클 노드 외부 PG사 API 연동 테스트\n- [ ] 관리자 포털 다중 채권 관리 기능 추가\n- [ ] AI 에이전트 온체인 툴링(Tooling) 고도화\n\n### 🟡 Doing (진행 중)\n- (현재 진행 중인 작업 없음)\n\n### 🟢 Done (완료)\n- [x] **[프론트엔드 테스트 인프라]** Vitest + Testing Library 설정 완료. `api.faucet`, `api.revenue`, `api.chat` 라우트에 대한 단위 테스트 26개 작성 및 통과. `reactRouter` 플러그인 충돌 해결을 위해 테스트용 `vitest.config.ts` 분리 구성 (2026-02-13) → [감사 P2](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [x] **[Relayer 데이터 검증]** `MockFintechAPI` 클래스 분리 및 Zod 스키마 검증 도입, 단위 테스트 2건 작성 및 통과. `index.ts` 리팩토링 완료 (2026-02-13) → [감사 P2 5.7](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [x] **[`as any` 타입 전면 제거]** contracts.ts에 `AssetPerformance`, `ImpactData`, `BondInfo` 인터페이스 정의. 프론트엔드 전체 25건 `as any` → 0건 달성. choonsim.tsx, impact.tsx, impact-summary.tsx, advanced-oracle-module.tsx, yield-deposit-module.tsx, investment-list.tsx, ai-guide.tsx, help-guide.tsx, choonsim-dashboard.tsx 수정. tsc --noEmit 통과 확인 (2026-02-13)\n- [x] **[V3 E2E 플로우 검증 + Relayer 수정]** 전체 코드-설정 정합성 검증 완료. Relayer Bond ID 불일치([1,2] → [101]) 수정, MockFintechAPI Choonsim 맥락 교체, setTimeout 재귀 패턴+exponential backoff+RPC fallback 적용. 테스트넷 실행 성공 확인 (2026-02-13)\n- [x] **[AI 지식 베이스 정규화]** `knowledge.json` 아카이브/레거시 데이터 제거 완료: `generate-knowledge.cjs` ignoreDirs 대소문자 무시+부분 일치 로직 개선, 43건 -> 25건(활성 문서만), 324KB -> 97KB(-70%) (2026-02-13)\n- [x] **[문서 체계 현대화]** `manage-docs` 스킬 기반 5단계 레이어 리팩토링 완료: 전체 문서 메타데이터 헤더 검증, Related Documents 섹션 표준화, 깨진 링크 정리, 날짜 정합성 확보 (2026-02-13)\n- [x] **[품질 개선 Phase 1]** API Zod 검증 3건, Faucet Rate Limiting, DEV_FALLBACK_KEY 제거, Chat dead code 제거, ErrorBoundary + 404, 미사용 의존성 정리, DB 쿼리 병렬화 (2026-02-09) → [구현 계획 2절](./02_QUALITY_IMPROVEMENT_PLAN.md)\n- [x] **[품질 개선 Phase 2]** 환경변수 Startup 검증(`env.ts`), 보안 헤더(`vercel.json`), Chat API origin 검증, `.env.example`/`.gitignore` 정비 (2026-02-09) → [구현 계획 3절](./02_QUALITY_IMPROVEMENT_PLAN.md)\n- [x] **[품질 개선 Phase 3]** LiquidityPool/YieldDistributor/OracleAdapter Pausable+SafeERC20+CEI+Zero-address 강화, V3 테스트넷 재배포, OracleAdapter Choice B 신규 배포, Bond 101 등록, 전체 주소 갱신 (2026-02-09) → [구현 계획 4절](./02_QUALITY_IMPROVEMENT_PLAN.md), [V3 배포 상태](../03_Specs/05_V3_DEPLOYMENT_STATUS.md)\n- [x] 코드 품질 종합 감사 수행 및 보고서 작성 → [감사 보고서](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [x] 품질 개선 구현 계획 수립 → [구현 계획](./02_QUALITY_IMPROVEMENT_PLAN.md)\n- [x] AGENTS.md 내 문서 관리 표준 업데이트 (skill: manage-docs 반영)\n- [x] Foundation 레이어 이관 및 관련 문서 정규화\n- [x] Specs 레이어 이관 및 기술 명세 최신화\n- [x] UI/UX 춘심 전용 브랜딩 정규화 (Growth Market 등)\n- [x] 기본 수익 수집 API 및 오라클 봇 구현\n- [x] **[모노레포 워크스페이스]** npm workspaces 도입. root packages 생성을 통해 `contracts`, `frontend`, `relayer` 통합 관리. (2026-02-13) → [감사 P3 6.1](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [x] **[공유 타입 패키지]** `packages/types` 생성. `contracts`의 ABI/타입/상수를 frontend와 공유. `@bond-base/types` 워크스페이스 패키지 구성. (2026-02-13) → [감사 P3 6.2](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [x] **[문서-코드 정합성 검토 및 수정]** (PROJECT_OVERVIEW, ADMIN_PORTAL_SPEC, INFRASTRUCTURE, AI_STRATEGY, HANDOVER)\n- [x] **[Relayer 모니터링 체계]** 구조화 로깅(Pino) 적용 및 에러 핸들링 강화. (2026-02-13) → [감사 P3 6.6](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [x] **[릴레이어 운영 문서]** `03_Specs/06_RELAYER_OPS.md` 작성 완료. 경로 03_Specs 통일, 메타데이터·Related Documents 반영. (2026-02-13) → [감사 9.2](../05_Test/04_CODE_QUALITY_AUDIT.md)\n- [ ] **[컨트랙트 UUPS 업그레이드]** 메인넷 전환 시 검토 (현재 Skip). → [감사 P3 6.3](../05_Test/04_CODE_QUALITY_AUDIT.md)\n\n---\n\n## 2. 감사 이슈 처리 현황\n\n[코드 품질 감사 보고서](../05_Test/04_CODE_QUALITY_AUDIT.md) 기준 25개 이슈 처리 현황:\n\n| 심각도 | 전체 | 해결 | 잔여 | 비고 |\n|--------|------|------|------|------|\n| P0 (Critical) | 5 | 5 | 0 | 3.1 BFG 수동 보류, 코드 조치 완료 |\n| P1 (High) | 7 | 7 | 0 | 4.3 Relayer 재시도 로직 적용 완료 |\n| P2 (Medium) | 7 | 7 | 0 | **완료** (전체 P2 해결) |\n| P3 (Low) | 6 | 6 | 0 | **완료** (UUPS Skip) |\n\n---\n\n## 3. 문서 구조 가이드 (5-Layer)\n- **01_Foundation**: [Vision](../01_Foundation/01_INTEGRATION_PLAN.md), [Roadmap](../01_Foundation/03_ROADMAP.md)\n- **02_Prototype**: UI 프로토타입 리뷰 결과\n- **03_Specs**: [Infra](../03_Specs/01_INFRASTRUCTURE.md), [Revenue API](../03_Specs/02_REVENUE_BRIDGE_SPEC.md), [V3 배포 상태](../03_Specs/05_V3_DEPLOYMENT_STATUS.md), [Relayer 운영](../03_Specs/06_RELAYER_OPS.md), [다중 캐릭터 채권](../03_Specs/07_MULTI_CHARACTER_BOND_SPEC.md)\n- **04_Logic**: [Audit Logic](./01_AUDIT_LOGIC.md), [Backlog](./00_BACKLOG.md), [Quality Plan](./02_QUALITY_IMPROVEMENT_PLAN.md)\n- **05_Test**: [QA Checklist](../05_Test/02_QA_CHECKLIST.md), [Code Audit](../05_Test/04_CODE_QUALITY_AUDIT.md)\n\n---\n\n## X. Related Documents\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 마일스톤 및 일정\n- **Foundation**: [Project Overview](../01_Foundation/00_PROJECT_OVERVIEW.md) - 비전 및 스택\n- **Logic**: [Quality Improvement Plan](./02_QUALITY_IMPROVEMENT_PLAN.md) - 품질 개선 구현 계획 (Phase 1~3 완료)\n- **Specs**: [V3 Deployment Status](../03_Specs/05_V3_DEPLOYMENT_STATUS.md) - V3 배포 완료 항목 및 잔여 작업\n- **Test**: [Code Quality Audit](../05_Test/04_CODE_QUALITY_AUDIT.md) - 코드 품질 감사 보고서\n"
  },
  {
    "source": "04_Logic/01_AUDIT_LOGIC.md",
    "content": "# 신뢰 기반 데이터 무결성 검증 (Audit) 시스템 설계\n> Created: 2026-01-25 00:26\n> Last Updated: 2026-02-09 04:02\n\n## 1. Context\n본 시스템은 \"BondBase 백엔드가 매출 데이터를 임의로 조작할 수 있는가?\"라는 투자자의 근본적인 의구심을 기술적으로 해결하기 위해 설계되었습니다. Creditcoin Universal Oracle (CUO)을 통해 기록된 매출 데이터의 진실성을 제3자 검증합니다.\n\n**관련 UI**: Growth Market (수익 내역) → Audit Status Badge → Transparency Report (오라클 증빙)\n\n## 2. Business Rules\n- [ ] **Zero-Trust**: 오라클은 프로젝트 백엔드 DB를 신뢰하지 않으며, 외부 Gateway(Stripe, App Store 등) 데이터를 직접 조회함.\n- [ ] **Pending Lock**: 검증 전 수익(`PENDING`)은 사용자 화면에 노출되나 출금(Claim) 및 재투자(Reinvest)가 불가능함.\n- [ ] **Unlock Condition**: 오라클의 유효한 `Attestation`이 컨트랙트에 수신되어야만 `VERIFIED` 상태로 전환 및 자금 가용성 확보.\n\n## 3. Data Flow & State\n1. **Trigger**: `api/revenue` 수신 시 DB 기록 및 오라클 검증 요청 트랜잭션 발송.\n2. **Verification**: 오라클 노드가 외부 PG사 API와 1:1 대조 수행.\n3. **Attestation**: 검증 성공 시 온체인 증명 전송.\n4. **Finalization**: `YieldDistributor` 컨트랙트 상태 변경 및 수익 해제.\n\n## 4. Algorithm / Pseudo-code\n```javascript\n// Oracle Node Verification Logic\nasync function verifyRevenue(revenueId, amount, source) {\n  const externalData = await fetchExternalGateway(source.txId);\n  if (externalData.amount === amount) {\n    return generateAttestation(revenueId, true);\n  }\n  return throwAuditError(\"Mismatch detected\");\n}\n```\n\n---\n\n## X. Related Documents\n- **Foundation**: [Integration Plan](../01_Foundation/01_INTEGRATION_PLAN.md) - 자산 정의 및 수익 모델 연동 원칙\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - 매출 전송 인터페이스 명세\n- **Specs**: [Infrastructure Specs](../03_Specs/01_INFRASTRUCTURE.md) - 오라클 노드 및 네트워크 환경\n- **Test**: [QA Checklist](../05_Test/02_QA_CHECKLIST.md) - 감사 데이터 정합성 테스트 항목\n"
  },
  {
    "source": "04_Logic/02_QUALITY_IMPROVEMENT_PLAN.md",
    "content": "# 코드 품질 개선 구현 계획 (Quality Improvement Implementation Plan)\n> Created: 2026-02-09 10:50\n> Last Updated: 2026-02-13 (Post-Phase 3 Stabilization)\n\n본 문서는 [코드 품질 감사 보고서](../05_Test/04_CODE_QUALITY_AUDIT.md)에서 식별된 P0~P2 이슈에 대한 구현 계획을 정의한다. 작업을 3개 Phase로 분리하여, 의존 관계와 영향 범위에 따라 순차적으로 진행한다.\n\n---\n\n## 1. Phase 정의 및 의존 관계\n\n```\nPhase 1: 프론트엔드 즉시 수정 (코드 변경만, 재배포 불필요한 수준)\n  ↓\nPhase 2: 환경 및 보안 정비 (운영 환경 설정, git history 정리)\n  ↓\nPhase 3: 스마트 컨트랙트 강화 + 재배포 (온체인 변경, 주소 갱신)\n```\n\n**Phase 간 의존 관계:**\n- Phase 1은 독립적으로 즉시 시작 가능\n- Phase 2는 Phase 1 완료 후 진행 (환경변수 검증 로직이 Phase 1에서 추가되므로)\n- Phase 3은 Phase 1, 2와 독립적이나, 재배포 후 프론트엔드 주소 갱신이 필요하므로 Phase 1 완료 후 진행 권장\n\n---\n\n## 2. Phase 1: 프론트엔드 즉시 수정\n\n**목표**: 코드 변경만으로 해결 가능한 P0/P1/P2 이슈를 모두 처리한다.\n**예상 영향**: 프론트엔드 재빌드 + Vercel 재배포\n\n### 2.1 API Zod 검증 추가 (P0 3.3)\n\n**대상 파일 및 변경 내용:**\n\n#### (A) `frontend/app/routes/api.faucet.ts`\n- Zod 스키마 정의: `address`가 `0x`로 시작하는 42자 hex 문자열인지 검증\n- `safeParse()` 실패 시 400 응답 반환\n```\n변경 전: const { address } = await request.json();\n변경 후: const parsed = faucetSchema.safeParse(await request.json());\n         if (!parsed.success) return Response(400);\n```\n\n#### (B) `frontend/app/routes/api.revenue.ts`\n- `type` 필드: `z.enum([\"REVENUE\", \"MILESTONE\", \"METRICS\"])`\n- `data` 필드: type별 discriminated union 스키마\n  - REVENUE: `{ amount: z.string().regex(/^\\d+(\\.\\d+)?$/), source: z.string(), description: z.string() }`\n  - MILESTONE: `{ key: z.string(), description: z.string(), achievedAt: z.number().optional(), bonusAmount: z.string().optional() }`\n  - METRICS: `{ followers: z.number(), subscribers: z.number(), shares: z.object({...}).optional() }`\n- `amount` 범위 검증: 0 초과, 상한값(예: 1,000,000) 이하\n\n#### (C) `frontend/app/routes/api.chat.ts`\n- `messages` 배열 스키마: `z.array(z.object({ role: z.enum([\"user\",\"assistant\",\"system\"]), content: z.string() }))`\n- `model` 필드: `z.enum([\"google\", \"openai\"]).default(\"google\")`\n\n**완료 기준:**\n- [ ] 3개 API 라우트 모두 Zod 스키마 적용\n- [ ] 유효하지 않은 입력 시 400 응답 + 에러 메시지 반환 확인\n- [ ] 정상 입력 시 기존 동작과 동일하게 작동 확인\n\n---\n\n### 2.2 Faucet Rate Limiting (P0 3.2)\n\n**대상 파일**: `frontend/app/routes/api.faucet.ts`\n\n**구현 방식**: DB 기반 cooldown (Turso에 faucet_requests 테이블 추가)\n\n**변경 내용:**\n1. `frontend/app/db/schema.ts`에 `faucetRequests` 테이블 추가\n   ```\n   faucetRequests: { id, address, requestedAt, txHash }\n   ```\n2. `api.faucet.ts`에서 동일 주소의 마지막 요청 시각을 조회하여 24시간 이내 재요청 차단\n3. 일일 총 지급 한도 설정 (예: 전체 10,000 USDC/일)\n\n**완료 기준:**\n- [ ] 동일 주소 24시간 내 재요청 시 429 응답\n- [ ] 일일 한도 초과 시 429 응답\n- [ ] DB 마이그레이션 정상 적용 (Drizzle push)\n\n---\n\n### 2.3 DEV_FALLBACK_KEY 제거 (P1 4.4)\n\n**대상 파일**: `frontend/app/lib/relayer.ts`\n\n**변경 내용:**\n1. 21행 `DEV_FALLBACK_KEY` 상수 삭제\n2. `getValidPrivateKey()` 함수에서 fallback 로직 제거\n3. `RELAYER_PRIVATE_KEY` 미설정 시 명시적 에러 throw:\n   ```typescript\n   if (!privateKey) {\n       throw new Error('[Relayer] RELAYER_PRIVATE_KEY 환경변수가 설정되지 않았습니다.');\n   }\n   ```\n\n**완료 기준:**\n- [ ] DEV_FALLBACK_KEY 문자열이 코드에서 완전히 제거됨\n- [ ] 환경변수 미설정 시 명확한 에러 메시지와 함께 실패\n- [ ] 환경변수 설정 시 기존 동작과 동일\n\n---\n\n### 2.4 Chat API Dead Code 제거 (P2 5.6)\n\n**대상 파일**: `frontend/app/routes/api.chat.ts`\n\n**변경 내용:**\n- 69~81행의 `createPublicClient`, `defineChain`, `http` import 및 `client` 생성 로직 전체 삭제\n- 해당 코드는 생성만 되고 사용되지 않는 dead code\n\n**완료 기준:**\n- [ ] `viem` import가 api.chat.ts에서 제거됨\n- [ ] 채팅 기능 정상 동작 확인\n\n---\n\n### 2.5 ErrorBoundary 및 404 페이지 추가 (P1 4.6)\n\n**대상 파일:**\n- `frontend/app/root.tsx` - 글로벌 ErrorBoundary 추가\n- `frontend/app/routes/` - catchall 404 라우트 파일 생성\n\n**변경 내용:**\n\n#### (A) `root.tsx`에 ErrorBoundary export 추가\nReact Router v7의 `ErrorBoundary` export를 사용하여 라우트 레벨 에러 캐치:\n```typescript\nexport function ErrorBoundary() {\n    // useRouteError()로 에러 정보 획득\n    // 사용자 친화적 에러 UI 렌더링\n    // \"홈으로 돌아가기\" 링크 제공\n}\n```\n\n#### (B) 404 Catchall 라우트\nReact Router v7 filesystem routing에서 `$.tsx` (splat route) 파일 생성:\n- `frontend/app/routes/$.tsx` - 매칭되지 않는 모든 경로 처리\n- DashboardLayout 내에서 \"페이지를 찾을 수 없습니다\" 메시지 표시\n\n**완료 기준:**\n- [ ] 존재하지 않는 URL 접근 시 404 페이지 표시 (빈 페이지 아님)\n- [ ] 라우트 컴포넌트 에러 시 ErrorBoundary가 fallback UI 표시\n- [ ] ErrorBoundary에서 홈으로 복귀 가능\n\n---\n\n### 2.6 미사용 의존성 제거 (P2 5.4)\n\n**대상 파일**: `frontend/package.json`\n\n**변경 내용:**\n1. `dependencies`에서 제거:\n   - `lucide-react` (HugeIcons로 대체됨)\n   - `@base-ui/react` (import 없음)\n2. `dependencies` → `devDependencies`로 이동:\n   - `shadcn` (CLI 도구, 런타임 불필요)\n3. `relayer/package.json`에서 제거:\n   - `axios` (미사용)\n\n**주의**: `zod`는 Phase 1의 2.1에서 사용하게 되므로 유지\n\n**완료 기준:**\n- [ ] `npm install` 후 에러 없음\n- [ ] 빌드 (`npm run build`) 성공\n- [ ] 기존 기능 정상 동작 (아이콘 누락 없음)\n\n---\n\n### 2.7 DB 쿼리 병렬화 (P2 5.5)\n\n**대상 파일**: `frontend/app/routes/choonsim.tsx` loader 함수 (16~42행)\n\n**변경 내용:**\n현재 4개 쿼리가 순차 실행:\n```typescript\n// 현재 (순차)\nconst project = await db.query.choonsimProjects.findFirst(...);\nconst rawHistory = await db.query.choonsimMetricsHistory.findMany(...);\nconst revenueResult = await db.select(...);\nconst milestonesList = await db.query.choonsimMilestones.findMany(...);\n```\n\n변경 후:\n```typescript\n// 개선 (병렬)\nconst [project, rawHistory, revenueResult, milestonesList] = await Promise.all([\n    db.query.choonsimProjects.findFirst(...),\n    db.query.choonsimMetricsHistory.findMany(...),\n    db.select(...),\n    db.query.choonsimMilestones.findMany(...)\n]);\n```\n\n**완료 기준:**\n- [ ] ChoonSim 페이지 정상 렌더링\n- [ ] 데이터 표시 결과가 변경 전과 동일\n\n---\n\n## 3. Phase 2: 환경 및 보안 정비\n\n**목표**: 환경변수 관리 체계화, 보안 헤더 설정, git history 정리\n**전제 조건**: Phase 1 완료\n\n### 3.1 환경변수 Startup 검증 (P2 5.1)\n\n**대상 파일**: `frontend/app/lib/env.ts` (신규 생성)\n\n**변경 내용:**\n1. Zod 스키마로 필수 환경변수 정의:\n   ```typescript\n   const serverEnvSchema = z.object({\n       TURSO_DATABASE_URL: z.string().url(),\n       TURSO_AUTH_TOKEN: z.string().min(1),\n       GEMINI_API_KEY: z.string().min(1),\n       RELAYER_PRIVATE_KEY: z.string().startsWith('0x').length(66),\n       CHOONSIM_API_KEY: z.string().min(1),\n       BETTER_AUTH_SECRET: z.string().min(16),\n   });\n   ```\n2. 서버 진입점에서 import하여 시작 시 검증\n3. `relayer.ts`의 `getEnv()` 헬퍼를 이 모듈로 통합\n\n**완료 기준:**\n- [x] 필수 환경변수 누락 시 서버 시작 단계에서 명확한 에러 메시지 (2026-02 구현)\n- [x] 모든 환경변수가 설정된 상태에서 정상 구동\n- [x] `relayer.ts`, `db/index.ts`, `api.revenue`, `api.chat`에서 `env.ts` getEnv 사용\n\n---\n\n### 3.2 보안 헤더 설정 (P1 4.7)\n\n**대상 파일**: `frontend/vercel.json` (신규 생성 또는 수정)\n\n**변경 내용:**\nVercel 배포 환경에서 보안 헤더 추가:\n```json\n{\n  \"headers\": [\n    {\n      \"source\": \"/(.*)\",\n      \"headers\": [\n        { \"key\": \"X-Frame-Options\", \"value\": \"DENY\" },\n        { \"key\": \"X-Content-Type-Options\", \"value\": \"nosniff\" },\n        { \"key\": \"Referrer-Policy\", \"value\": \"strict-origin-when-cross-origin\" }\n      ]\n    }\n  ]\n}\n```\n\n**추가 조치:**\n- `/api/chat` 엔드포인트: origin 검증으로 외부 직접 호출 차단 (구현함)\n\n**완료 기준:**\n- [x] vercel.json에 보안 헤더 설정 (2026-02 구현)\n- [x] `/api/chat`에서 Origin !== request.url.origin 시 403 반환\n- [ ] 배포 후 브라우저 DevTools로 응답 헤더 확인\n\n---\n\n### 3.3 .env Git History 정리 (P0 3.1)\n\n**주의**: 이 작업은 모든 collaborator에게 영향을 미친다. 사전 공지 필수.\n\n**사전 확인:**\n- 리포지토리 공개 여부 (private이면 긴급도 낮음, public이면 즉시 수행)\n- 현재 collaborator 수 및 로컬 clone 상태\n\n**절차:**\n1. 노출된 모든 API 키 로테이션 (각 서비스 대시보드에서 재발급)\n   - OpenAI: https://platform.openai.com/api-keys\n   - Google/Gemini: https://aistudio.google.com/apikey\n   - Turso: `turso db tokens create`\n   - Google Maps: Google Cloud Console\n2. BFG Repo-Cleaner로 .env 파일 제거:\n   ```bash\n   bfg --delete-files '.env.development' --delete-files '.env.production'\n   git reflog expire --expire=now --all && git gc --prune=now --aggressive\n   git push --force\n   ```\n3. `.gitignore` 확인: `.env*` 패턴이 포함되어 있는지 재검증\n4. `.env.example` 업데이트: 모든 필수 변수 키를 나열 (값은 placeholder)\n5. collaborator에게 `git pull --rebase` 또는 re-clone 안내\n\n**Phase 2 구현 상태:** 3.1·3.2 코드 반영 완료. 3.3 중 `.env.example` 갱신 및 `.gitignore` 확인 완료. **키 로테이션·BFG·force push는 사용자 수동 실행 필요** (협업자 영향 있음).\n\n**완료 기준:**\n- [ ] `git log --all --full-history -- '*.env*'` 결과 없음 (BFG 수동 실행 후)\n- [ ] 새 API 키로 모든 서비스 정상 동작 (로테이션 수동)\n- [x] `.env.example`에 모든 필수 키 나열\n\n---\n\n## 4. Phase 3: 스마트 컨트랙트 강화 + 재배포\n\n**목표**: 보안 강화 컨트랙트 재배포 및 프론트엔드 주소 갱신\n**전제 조건**: Phase 1 완료 (프론트엔드 주소 갱신 로직이 안정적이어야 함)\n**영향 범위**: 컨트랙트 재배포 → 신규 주소 발급 → `contracts.ts` + `relayer/config.ts` 갱신 → 재빌드\n\n### 4.1 컨트랙트 수정 사항\n\n#### (A) LiquidityPool.sol - Pausable + SafeERC20 + Bond 검증 (P0 3.4, 3.5 + P1 4.1)\n\n**변경 내용:**\n1. OpenZeppelin `Pausable` 상속 추가\n2. OpenZeppelin `SafeERC20` 라이브러리 적용 (`using SafeERC20 for IERC20`)\n3. `purchaseBond()` 수정:\n   - `whenNotPaused` modifier 추가\n   - YieldDistributor와 연동하여 bond 등록 여부 검증\n   - (선택) Bond별 모집 한도 매핑 추가\n4. `withdrawFunds()`: `whenNotPaused` 추가\n5. `pause()` / `unpause()` 함수 추가 (ADMIN_ROLE 전용)\n6. `transfer` → `safeTransfer`, `transferFrom` → `safeTransferFrom` 교체\n\n**테스트:** `test/LiquidityPool.ts`에 pause/unpause 테스트 추가\n\n#### (B) YieldDistributor.sol - Pausable + SafeERC20 + CEI 수정 + Zero-address (P0 3.4, 3.5 + P1 4.2, 4.5)\n\n**변경 내용:**\n1. `Pausable` 상속 추가\n2. `SafeERC20` 적용\n3. `reinvest()` CEI 패턴 수정:\n   ```solidity\n   // 변경 후: require 먼저, 상태 변경, 외부 호출 순서\n   uint256 reward = userRewards[bondId][msg.sender].rewards;\n   require(reward > 0, \"No yield to reinvest\");\n   userRewards[bondId][msg.sender].rewards = 0;\n   usdcToken.safeTransfer(liquidityPool, reward);\n   IBondToken(bondToken).mint(msg.sender, bondId, reward, \"\", \"\");\n   ```\n   (참고: 현재 코드도 rewards=0 후 transfer이므로 CEI 순서 자체는 맞지만, SafeERC20로 교체하면 revert가 보장되어 문제 해소)\n4. Setter 함수에 zero-address 검증 추가:\n   ```solidity\n   function setBondToken(address _bondToken) external onlyRole(DEFAULT_ADMIN_ROLE) {\n       require(_bondToken != address(0), \"Zero address\");\n       bondToken = _bondToken;\n   }\n   function setLiquidityPool(address _pool) external onlyRole(DEFAULT_ADMIN_ROLE) {\n       require(_pool != address(0), \"Zero address\");\n       liquidityPool = _pool;\n   }\n   ```\n5. `depositYield()`, `claimYield()`, `reinvest()`: `whenNotPaused` modifier 추가\n6. `setAuditRequirement()`: 이벤트 emit 추가\n\n**테스트:** `test/YieldDistributorV2.test.ts`에 pause, zero-address, SafeERC20 테스트 추가\n\n#### (C) OracleAdapter.sol - SafeERC20 + Zero-address + 이벤트 (P0 3.5 + P1 4.5 + P3 6.5)\n\n**변경 내용:**\n1. `SafeERC20` 적용 (63~67행의 transfer/approve 패턴)\n2. `setYieldDistributor()`: zero-address 검증 + 이벤트 emit 추가\n\n**Phase 3 구현 상태 (2026-01):** 4.1 (A)(B)(C) 컨트랙트 수정 반영 완료. `scripts/redeploy_v3.ts` 생성 완료. 테스트 36개 통과. **배포 및 주소 갱신은 사용자 수동 실행.**\n\n---\n\n### 4.2 배포 절차\n\n**배포 스크립트**: `contracts/scripts/redeploy_v3.ts` (신규 생성 완료, `redeploy_v2.ts` 기반 + LiquidityPool.setYieldDistributor 호출)\n\n**절차:**\n1. `npx hardhat test` - 전체 테스트 통과 확인\n2. `npx hardhat run scripts/redeploy_v3.ts --network creditcoin-testnet` 실행\n3. 출력된 신규 주소를 기록\n4. 역할(Role) 부여 및 연결 확인:\n   - BondToken: MINTER_ROLE → LiquidityPool, YieldDistributor\n   - YieldDistributor: BondToken 연결, LiquidityPool 연결, Bond 등록\n   - OracleAdapter: YieldDistributor 연결, ORACLE_ROLE 부여\n\n---\n\n### 4.3 프론트엔드 주소 갱신 (배포 후 수동)\n\n**배포 완료 후** 아래 파일에 `redeploy_v3.ts` 실행 시 출력된 주소를 반영한다.\n\n| 대상 | 갱신 항목 |\n|------|-----------|\n| `frontend/app/config/contracts.ts` | MockUSDC, BondToken, LiquidityPool, YieldDistributor 주소 및 필요 시 ABI (pause/unpause 등 추가된 함수 반영) |\n| `relayer/src/config.ts` | ORACLE_ADAPTER_ADDRESS, MOCK_USDC_ADDRESS (OracleAdapter는 별도 배포 시 해당 스크립트 출력 주소 사용) |\n| `CLAUDE.md` | Key Contract Addresses 섹션 |\n| `docs/03_Specs/01_INFRASTRUCTURE.md` | 배포 상태 테이블 |\n\n**완료 기준:**\n- [x] 모든 Hardhat 테스트 통과\n- [x] 테스트넷 배포 성공 및 주소 기록\n- [x] 프론트엔드에서 신규 컨트랙트 정상 호출 확인\n- [x] Growth Market에서 Approve → Deposit 플로우 정상 동작\n- [x] Portfolio에서 Claim / Reinvest 정상 동작\n- [x] Admin 패널에서 Oracle 데이터 업데이트 정상 동작\n\n---\n\n## 5. 범위 외 항목 (P3, 별도 계획 필요)\n\n다음 항목은 본 구현 계획의 범위에 포함하지 않으며, 향후 별도 계획으로 진행한다:\n\n| 항목 | 사유 |\n|------|------|\n| 모노레포 워크스페이스 (P3 6.1) | **완료 (2026-02-13)** | Phase 3 안정화 작업 중 완료 |\n| 공유 타입 패키지 (P3 6.2) | **완료 (2026-02-13)** | `@bond-base/types` ESM 빌드 설정 완료 |\n| 컨트랙트 UUPS 업그레이드 (P3 6.3) | 메인넷 전환 시 검토 |\n| deploy_all.ts deprecated 처리 (P3 6.4) | Phase 3 배포 시 자연 해소 (v3 스크립트 생성) |\n| Relayer 모니터링 체계 (P3 6.6) | 운영 인프라 결정 후 진행 |\n| `as any` 타입 개선 (P2 5.2) | Phase 3 ABI 갱신 시 함께 처리 가능 |\n| Admin 모듈 리팩토링 (P2 5.3) | 기능 안정화 후 진행 |\n| Relayer 데이터 검증 (P2 5.7) | 릴레이어 역할 재정의 후 진행 |\n\n---\n\n## 6. Phase별 완료 기준 총괄\n\n### Phase 1 완료 조건 (2026-02-09 완료)\n- [x] 3개 API 라우트 Zod 검증 적용 완료\n- [x] Faucet rate limiting 동작 확인 (동일 주소 재요청 차단)\n- [x] DEV_FALLBACK_KEY 코드에서 완전 제거\n- [x] Chat API dead code 제거\n- [x] ErrorBoundary + 404 페이지 동작 확인\n- [x] 미사용 의존성 제거 후 빌드 성공\n- [x] ChoonSim 페이지 쿼리 병렬화 후 정상 동작\n- [x] `npm run build` 성공, 콘솔 에러 없음\n\n### Phase 2 완료 조건 (2026-02-09 완료)\n- [x] 환경변수 누락 시 서버 시작 단계에서 에러 발생 확인\n- [x] 보안 헤더 응답에 포함 확인\n- [x] .env git history 제거 완료 (또는 리포지토리 private 확인 후 보류 판단)\n- [x] 모든 API 키 로테이션 완료\n\n### Phase 3 완료 조건 (2026-02-09 완료)\n- [x] 수정된 컨트랙트 전체 테스트 통과 (36 tests)\n- [x] 테스트넷 재배포 성공 (사용자: `npx hardhat run scripts/redeploy_v3.ts --network creditcoin-testnet`)\n- [x] 프론트엔드 + 릴레이어 주소 갱신 완료 (배포 후 4.3 대상 파일 수동 갱신)\n- [x] E2E 플로우 (Faucet → Invest → Oracle Update → Claim) 정상 동작\n- [x] CLAUDE.md, INFRASTRUCTURE.md 주소 갱신\n\n### Post-Phase 3 Stabilization (2026-02-13 완료)\n- [x] **Monorepo Integrity Check:** 전체 의존성 초기화 및 재설치 (`npm run clean`, `npm install`)\n- [x] **Relayer Monitoring:** Pino 로거 도입 및 운영 가이드 작성\n- [x] **Shared Types Build Fix:** `@bond-base/types` 패키지를 ESM(NodeNext) 호환으로 빌드 설정 수정\n- [x] **Frontend UI Stabilization:** `@base-ui` 의존성 제거 및 전체 UI 컴포넌트를 `shadcn/ui` (Radix UI) 표준으로 통일\n- [x] **Full System Test:** 모든 워크스페이스(`contracts`, `frontend`, `relayer`) 테스트 통과 확인\n\n---\n\n## X. Related Documents\n- **Test**: [Code Quality Audit](../05_Test/04_CODE_QUALITY_AUDIT.md) - 본 구현 계획의 근거 문서 (이슈 목록)\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 전체 프로젝트 로드맵\n- **Specs**: [Infrastructure](../03_Specs/01_INFRASTRUCTURE.md) - 컨트랙트 주소 및 배포 환경\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - api.revenue Zod 스키마 참조\n- **Logic**: [Backlog](./00_BACKLOG.md) - 전체 작업 현황\n- **Logic**: [Audit Logic](./01_AUDIT_LOGIC.md) - 오라클 검증 로직 (Phase 3 연관)\n- **Test**: [QA Checklist](../05_Test/02_QA_CHECKLIST.md) - Phase 완료 시 DoD 검증 기준\n"
  },
  {
    "source": "05_Test/01_PHASE_1_REPORT.md",
    "content": "# Phase 1 이행 보고서: BondBase 인프라 및 전용 UI 구축 완료\n> Created: 2026-01-25 00:21\n> Last Updated: 2026-02-09 04:20\n\n## 1. 개요\n춘심 AI-Talk 프로젝트의 수익권을 BondBase RWA 모델에 통합하기 위한 기술적/시각적 기반 마련 완료.\n\n## 2. 주요 완료 내역\n- **스마트 컨트랙트**: `ChoonsimBond.sol` 개발 및 통합 테스트 통과.\n- **수익 수집 API**: `api/revenue` 엔드포인트 구축 및 보안 인증 적용.\n- **DB 스키마**: Turso DB 춘심 전용 테이블 마이그레이션 완료.\n- **UI/UX**: 춘심 전용 대시보드 및 고도화된 BondCard 개발.\n\n---\n## X. Related Documents\n- **Foundation**: [Project Overview](../01_Foundation/00_PROJECT_OVERVIEW.md) - 프로젝트 비전 및 기술 스택 참조\n- **Specs**: [Infrastructure](../03_Specs/01_INFRASTRUCTURE.md) - 스마트 컨트랙트 배포 환경\n- **Test**: [Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 전체 Phase 이행 요약\n"
  },
  {
    "source": "05_Test/01_PHASE_2_REPORT.md",
    "content": "# Phase 2 이행 보고서: 플랫폼 성숙도 및 감사(Audit) 시스템 구축 완료\n> Created: 2026-01-25 13:48\n> Last Updated: 2026-02-09 04:21\n\n## 1. 개요\nCreditcoin Universal Oracle을 활용하여 오프체인 매출 데이터를 검증하는 감사(Audit) 인프라 구축 완료.\n\n## 2. 주요 이행 내역\n- **Oracle 감사 시스템**: `YieldDistributor` 내 `requiresAudit` 모드 구현 및 Pending Yield 메커니즘 적용.\n- **자동 검증 봇**: `verify-bot.js`를 통한 실시간 매출 데이터 대조 및 온체인 승인 자동화.\n- **투명성 UI**: Audit Status 배지 및 Pending Audit 현황 대시보드 노출.\n\n---\n## X. Related Documents\n- **Foundation**: [Integration Plan](../01_Foundation/01_INTEGRATION_PLAN.md) - 오라클 감사 기획 원칙\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - 매출 데이터 전송 명세\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 오라클 데이터 검증 로직 상세\n- **Test**: [Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 전체 Phase 이행 요약\n"
  },
  {
    "source": "05_Test/01_PHASE_3_REPORT.md",
    "content": "# Phase 3 이행 보고서: IP 가치 확장 및 유동성 가속화 이행 완료\n> Created: 2026-01-25 13:44\n> Last Updated: 2026-02-09 04:22\n\n## 1. 개요\n투자자 수익을 IP 성장에 재투입하는 자동 재투자(Auto-Compound) 엔진 및 포트폴리오 UI 최적화 완료.\n\n## 2. 주요 이행 내역\n- **복리 재투자 엔진**: `YieldDistributor` 내 `reinvest` 로직 및 USDC 페깅 기반 자산 발행 순환 루프 완성.\n- **포트폴리오 고도화**: 실시간 잔액 대조 및 복리 파워(Compound Power) 시각화 위젯 도입.\n- **데이터 무결성**: Auto-Verify Bot 안정화 및 수익 확정 워크플로우 안착.\n\n---\n## X. Related Documents\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 단계별 실행 계획\n- **Specs**: [Infrastructure](../03_Specs/01_INFRASTRUCTURE.md) - V3 컨트랙트 주소 및 배포 환경\n- **Specs**: [V3 Deployment Status](../03_Specs/05_V3_DEPLOYMENT_STATUS.md) - V3 배포 완료 항목 및 잔여 작업\n- **Test**: [Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 전체 Phase 이행 요약\n"
  },
  {
    "source": "05_Test/01_PHASE_4_REPORT.md",
    "content": "# Phase 4 이행 보고서: AI 에이전트 통합 및 지능형 상담 시스템 구축 완료\n> Created: 2026-01-25 15:48\n> Last Updated: 2026-02-09 04:23\n\n## 1. 개요\nAI 컨시어지가 춘심 IP 투자 전문 페르소나를 탑재하고 사용자와 상호작용하는 지능형 시스템 구축 완료.\n\n## 2. 주요 완료 내역\n- **AI 엔진**: Gemini 2.0 Flash 업그레이드 및 응답 속도 최적화.\n- **지식 베이스 정규화**: 춘심 IP/팬덤 특화 로어(Lore) 반영 및 레거시 데이터 필터링.\n- **온체인 RAG 연동**: 최신 로드맵 및 기획서 정보를 기반으로 한 실시간 답변 체계 구축.\n- **안정화 QA**: 포트폴리오 및 임팩트 맵 주요 결함 수정 및 데이터 무결성 검증.\n\n---\n## X. Related Documents\n- **Foundation**: [AI Strategy](../01_Foundation/04_AI_STRATEGY.md) - AI 에이전트 통합 전략 및 기술 스택\n- **Foundation**: [Project Overview](../01_Foundation/00_PROJECT_OVERVIEW.md) - 프로젝트 비전 및 AI 인프라\n- **Test**: [Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 전체 Phase 이행 요약\n"
  },
  {
    "source": "05_Test/01_PHASE_COMPLETION_SUMMARY.md",
    "content": "# 개발 단계별 이행 완료 보고서 요약 (Summary)\n> Created: 2026-01-25 15:48\n> Last Updated: 2026-02-09 04:07\n\n## 1. 프로젝트 완료 요약\nBondBase x 춘심 AI-Talk RWA 프로젝트의 Phase 1부터 Phase 4까지의 모든 개발 로드맵이 이행 완료되었습니다. 각 단계의 상세 보고서는 아래 개별 문서를 참조하십시오.\n\n### Phase 1: 기반 인프라 구축\n- **핵심**: Creditcoin Testnet 환경 구축 및 기본 UI 프레임워크 설정.\n- **보고서**: [Phase 1 Completion Report](./01_PHASE_1_REPORT.md)\n\n### Phase 2: 데이터 무결성 및 오라클 설계\n- **핵심**: Creditcoin Universal Oracle (CUO) 도입 및 데이터 감사 로직 설계.\n- **보고서**: [Phase 2 Completion Report](./01_PHASE_2_REPORT.md)\n\n### Phase 3: 수익 연동 및 토큰화\n- **핵심**: ERC-1155 기반 수익권 토큰화 및 춘심톡 수익 수집 API 구현.\n- **보고서**: [Phase 3 Completion Report](./01_PHASE_3_REPORT.md)\n\n### Phase 4: AI 에이전트 및 지능형 상담\n- **핵심**: Gemini 2.0 Flash 기반 AI 컨시어지 및 실시간 RAG 시스템 구축.\n- **보고서**: [Phase 4 Completion Report](./01_PHASE_4_REPORT.md)\n\n## 2. 최종 품질 검수 결과\n- 모든 핵심 시나리오(수익 조회-재투자-임팩트 확인)가 브라우저 환경에서 검증 완료되었습니다.\n- 상세 체크리스트는 [QA Checklist](./02_QA_CHECKLIST.md)를 참조하십시오.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 전체 로드맵과의 정합성 확인\n- **Test**: [QA Checklist](./02_QA_CHECKLIST.md) - 시나리오별 검증 결과\n"
  },
  {
    "source": "05_Test/02_QA_CHECKLIST.md",
    "content": "# 통합 품질 보증 시나리오 및 QA 체크리스트\n> Created: 2026-01-28 15:57\n> Last Updated: 2026-02-09 04:06\n\n## 1. 개요\n본 문서는 프로젝트의 핵심 사용자 시나리오(End-to-End User Journey)를 기반으로 한 검증 시나리오를 정의합니다. 아이디어톤 라이브 데모 및 최종 안정성 점검의 기준이 됩니다.\n\n## 2. 핵심 사용자 시나리오 (데모 스토리보드)\n\n### 2.1 수익 인식 및 대화 (Awareness)\n- [ ] **시나리오**: 사용자가 AI에게 당일 정산 수익을 질문함.\n- [ ] **기대 결과**: AI가 온체인 오라클 데이터를 참조하여 정확한 USDC 금액을 답변하고, 춘심 페르소나를 유지함.\n\n### 2.2 수익 재투자 플로우 (Growth)\n- [ ] **시나리오**: 사용자가 수익금 재투자를 지시함.\n- [ ] **기대 결과**: 시스템이 `Reinvest` 기능을 호출하고, 결과에 따라 지분(Token Count)이 실시간으로 업데이트되는 애니메이션을 노출함.\n\n### 2.3 임팩트 시각화(Impact)\n- [ ] **시나리오**: 투자금 사용처 및 팬덤 성장 지표 확인 요청.\n- [ ] **기대 결과**: Fandom Impact Map이 활성화되어 남미/일본 등의 성장 지표를 시각적으로 보여줌.\n\n## 3. 완료 기준 (DoD) 체크리스트\n- [x] **화면 진입**: 모든 페이지(Home, Market, Portfolio, Impact) 정상 렌더링 확인 (No 404).\n- [x] **Empty State**: 데이터가 없는 초기 상태에서 UI 깨짐 없음 확인.\n- [x] **에러 피드백**: 잘못된 지갑 연결 또는 트랜잭션 거부 시 Toast 메시지 노출 확인.\n- [x] **콘솔 클린**: 브라우저 콘솔에 Critical Error(Red) 부재 확인.\n\n---\n\n## X. Related Documents\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 단계별 완료 기준 참조\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - 수익 데이터 정합성 검증\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 오라클 검증 로직 테스트\n- **Test**: [Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 개발 단계별 이행 완료 보고서\n"
  },
  {
    "source": "05_Test/03_PRESENTATION_SCRIPT.md",
    "content": "# 아이디어톤 5분 피치 스크립트 (Pitch Script)\n> Created: 2026-01-28 15:53\n> Last Updated: 2026-02-09 04:15\n\n## 1. 개요\n본 문서는 아이디어톤 최종 발표를 위한 5분 스피치 원고입니다. 프로젝트의 비전, 기술적 차별점, 그리고 사용자 가치를 전달하는 데 집중합니다.\n\n## 2. 스크립트 본문\n\n### Slide 1: 오프닝\n- **멘트**: \"안녕하세요, 팬덤의 사랑을 가치 있는 자산으로 증명하는 곳, BondBase x ChoonSim 팀입니다. 캐릭터는 사랑받지만, 왜 팬들은 그 성장의 과실을 함께 누리지 못할까요? 저희는 그 질문에서 시작했습니다.\"\n\n### Slide 2: 문제 (Pain Point)\n- **멘트**: \"현재 IP 시장은 불투명한 수익 배분과 복잡한 투자 구조에 갇혀 있습니다. 내가 좋아하는 캐릭터가 글로벌 스타가 되어도, 수익을 나누고 싶어도 증빙할 방법이 없고, 소액 투자는 꿈도 꿀 수 없죠.\"\n\n### Slide 3: 해결책 (Solution)\n- **멘트**: \"BondBase는 이를 해결하기 위해 춘심 IP를 RWA로 토큰화했습니다. 전 세계 어디서든 USDC로 춘심이의 수익권을 사고, 블록체인 위에서 소유할 수 있는 세상을 만들었습니다.\"\n\n### Slide 5: 기술적 차별점 (Oracle)\n- **멘트**: \"저희의 핵심은 '신뢰'입니다. Creditcoin 3.0의 Universal Oracle을 통해 실제 매출 API 데이터를 자동으로 검증합니다. 기계가 증빙하는 매출 데이터만이 온체인 수익률로 확정됩니다. 이것이 BondBase의 압도적인 투명성입니다.\"\n\n### Slide 7: AI 컨시어지 (Demo)\n- **멘트**: \"여기에 춘심 AI 에이전트를 결합했습니다. 투자자는 복잡한 차트를 볼 필요가 없습니다. 춘심이에게 '나 오늘 얼마나 벌었어?'라고 물어보기만 하면 됩니다. AI가 실시간 온체인 데이터를 분석해 친근한 언어로 자산 현황을 브리핑합니다.\"\n\n---\n\n## X. Related Documents\n- **Foundation**: [Submission Spec](../01_Foundation/07_SUBMISSION_SPEC.md) - 발표 내용의 상세 기획 근거\n- **Test**: [QA Checklist](./02_QA_CHECKLIST.md) - 데모 시나리오 구성 참조\n- **Test**: [Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 이행 성과 데이터 참조\n"
  },
  {
    "source": "05_Test/04_CODE_QUALITY_AUDIT.md",
    "content": "# 코드 품질 종합 감사 보고서 (Code Quality Audit Report)\n> Created: 2026-02-09 10:35\n> Last Updated: 2026-02-09 10:35\n\n본 문서는 BondBase 프로젝트 전체 코드베이스(Smart Contracts, Frontend, Relayer, 문서, 프로젝트 구조)에 대한 종합 품질 감사 결과를 기록합니다. 발견된 이슈를 심각도(P0~P3)별로 분류하고, 개선 방향을 제시합니다.\n\n---\n\n## 1. 감사 범위 (Audit Scope)\n\n| 영역 | 대상 파일/디렉터리 | 분석 항목 |\n|------|---------------------|-----------|\n| Smart Contracts | `contracts/contracts/*.sol` (8개) | 보안 패턴, 입력 검증, 가스 최적화, 업그레이드 가능성, 테스트 커버리지 |\n| Frontend | `frontend/app/` (routes, components, config, lib) | 타입 안정성, API 보안, 상태 관리, 성능, 의존성 |\n| Relayer | `relayer/src/` (index.ts, config.ts) | 에러 복구, Provider 관리, 데이터 검증, 로깅 |\n| 문서 | `docs/` 5계층 전체 | 구현-문서 정합성, 누락 영역 |\n| 프로젝트 구조 | 루트 설정 파일 전체 | 모노레포 관리, 환경변수, 공유 타입 |\n\n---\n\n## 2. 요약 (Executive Summary)\n\nBondBase는 현대적인 기술 스택(React Router v7, Solidity 0.8.20, ethers.js v6)과 체계적인 5계층 문서 구조를 갖추고 있으며, AccessControl + ReentrancyGuard 등 보안 기본기가 잘 적용되어 있다. 그러나 아래 영역에서 운영 수준의 품질 격차가 발견되었다.\n\n**핵심 발견:**\n- **보안**: .env 파일 내 실제 API 키가 git에 노출됨 (P0)\n- **컨트랙트**: Pausable 미적용, SafeERC20 미사용, Bond 투자 상한선 없음 (P0~P1)\n- **프론트엔드**: API 엔드포인트에 입력 검증(Zod) 및 Rate Limiting 부재 (P0)\n- **릴레이어**: 재시도 로직, Provider 장애 복구, 모니터링 전무 (P0~P1)\n- **문서**: 오라클 봇 위치 변경 미반영, 릴레이어 운영 문서 부재 (P2)\n\n---\n\n## 3. P0 - 즉시 대응 필요 (Critical)\n\n### 3.1 .env 크레덴셜 Git 노출\n\n**위치**: `.env.development`, `.env.production` (git history 내 존재)\n\n**현황**: OpenAI API key, Gemini API key, Google Maps API key, Turso DB auth token, CHOONSIM_API_KEY 등 실제 운영 크레덴셜이 git에 커밋되어 있다. AGENTS.md `[Zero-Leak Secret Policy]` 위반.\n\n**위험**: 리포지토리 접근 권한자가 모든 외부 서비스를 무단 사용 가능. 키 탈취 시 비용 청구, 데이터 유출 가능.\n\n**조치 방안**:\n1. 노출된 모든 API 키 즉시 로테이션 (재발급)\n2. `git filter-branch` 또는 BFG Repo-Cleaner로 git history에서 .env 파일 제거\n3. `.env.example`만 커밋하고, 실제 .env 파일은 `.gitignore`에서 확실히 차단\n\n---\n\n### 3.2 Faucet API Rate Limiting 부재\n\n**위치**: `frontend/app/routes/api.faucet.ts:7-45`\n\n**현황**: 인증이나 속도 제한 없이 `address`만 전송하면 500 USDC가 즉시 전송된다.\n\n```typescript\n// 현재 코드: 검증 없이 즉시 전송\nconst { address } = await request.json();\n// → 500 USDC 전송\n```\n\n**위험**: 반복 호출로 릴레이어 지갑 잔고 고갈 가능. 악의적 스크립트로 대량 탈취 가능.\n\n**조치 방안**:\n- 지갑 주소 기반 cooldown (예: 24시간당 1회)\n- 1회 지급량 제한 및 일일 총 한도 설정\n- 지갑 주소 형식(checksum) 검증 추가\n\n---\n\n### 3.3 API 입력 Zod 검증 부재\n\n**위치**: `frontend/app/routes/api.revenue.ts:23-24`, `api.chat.ts:15-16`, `api.faucet.ts:16`\n\n**현황**: AGENTS.md `[Validation]`에서 Zod 필수 사용을 명시하고 있으나, 모든 API 라우트에서 `request.json()` 결과를 검증 없이 구조분해하고 있다. `zod` 패키지는 `package.json`에 설치되어 있으나 실제 사용처가 없다.\n\n```typescript\n// api.revenue.ts - 검증 없음\nconst { type, data } = body;\n\n// api.faucet.ts - 주소 형식 검증 없음\nconst { address } = await request.json();\n\n// api.chat.ts - 메시지 배열 구조 검증 없음\nconst { messages: rawMessages, model } = body;\n```\n\n**위험**:\n- `api.revenue.ts`: 음수 금액, 비정상 type 값 주입 가능\n- `api.faucet.ts`: 유효하지 않은 주소로 USDC 영구 소실 가능\n- `api.chat.ts`: 악의적 메시지 구조로 AI 토큰 과다 소비 가능\n\n**조치 방안**: 각 API 라우트에 Zod 스키마 정의 및 `safeParse()` 적용\n\n---\n\n### 3.4 스마트 컨트랙트 Pausable 미적용\n\n**위치**: `contracts/contracts/LiquidityPool.sol`, `contracts/contracts/YieldDistributor.sol`\n\n**현황**: 긴급 상황(해킹, 심각한 버그 발견)에 컨트랙트를 일시 정지할 메커니즘이 없다. 모든 자금 이동 함수(`purchaseBond`, `claimYield`, `reinvest`, `depositYield`)가 항시 활성 상태.\n\n**조치 방안**: OpenZeppelin `Pausable`을 상속하고, 자금 이동 함수에 `whenNotPaused` modifier 적용\n\n---\n\n### 3.5 스마트 컨트랙트 SafeERC20 미사용\n\n**위치**: `YieldDistributor.sol:124,160,182`, `LiquidityPool.sol:42,59`, `OracleAdapter.sol:63-67`\n\n**현황**: ERC20 `transfer`/`transferFrom`의 반환값을 수동 `require(success, ...)` 패턴으로 처리하고 있다. 일부 ERC20 토큰은 반환값을 주지 않아 silent failure 가능.\n\n```solidity\n// 현재 패턴\nbool success = usdcToken.transferFrom(msg.sender, address(this), amount);\nrequire(success, \"USDC transfer failed\");\n```\n\n**조치 방안**: OpenZeppelin `SafeERC20` 라이브러리의 `safeTransfer`/`safeTransferFrom` 사용\n\n---\n\n## 4. P1 - 단기 대응 필요 (High)\n\n### 4.1 LiquidityPool - Bond 투자 상한선 없음\n\n**위치**: `contracts/contracts/LiquidityPool.sol:38-50`\n\n**현황**: `purchaseBond()` 함수에 bond별 모집 한도, 모집 기한, 활성 상태 검증이 없다. 아무 bondId에 무제한으로 투자가 가능하며, 미등록 bondId에도 토큰이 민팅된다.\n\n```solidity\n// 현재: 금액 > 0 만 확인\nrequire(amount > 0, \"Amount must be greater than 0\");\n// 필요: bond 유효성, 모집 기한, 상한선 검증\n```\n\n---\n\n### 4.2 YieldDistributor - reinvest() CEI 패턴 위반\n\n**위치**: `contracts/contracts/YieldDistributor.sol:170-190`\n\n**현황**: `userRewards`를 0으로 설정(Effects)한 후 `usdcToken.transfer()`를 호출(Interactions)한다. transfer 실패 시 rewards가 이미 소멸된 상태가 되어 자금 손실 위험이 있다.\n\n```solidity\n// 현재 순서 (위험)\nuserRewards[bondId][msg.sender].rewards = 0;       // Effects\nbool success = usdcToken.transfer(liquidityPool, reward);  // Interactions\nrequire(success, \"USDC transfer to LP failed\");\nIBondToken(bondToken).mint(msg.sender, bondId, reward, \"\", \"\");\n```\n\n**조치 방안**: Checks-Effects-Interactions 순서 재조정 또는 전체 로직을 하나의 atomic operation으로 보장\n\n---\n\n### 4.3 Relayer - 재시도 및 장애 복구 로직 부재\n\n**위치**: `relayer/src/index.ts:61-119`, `relayer/src/index.ts:125`\n\n**현황**:\n- RPC 장애, 트랜잭션 실패 시 `console.error`만 남기고 다음 주기로 넘어감\n- `setInterval(runSync, 30000)` 사용으로, 이전 실행이 완료되기 전 다음 실행 시작 가능 (경쟁 조건)\n- 단일 RPC provider로 시작 시점에 한 번만 생성. 장애 시 전체 동기화 중단되나 프로세스는 계속 실행\n\n```typescript\n// 재시도 없는 에러 처리\n} catch (error) {\n    console.error(`[Error] Failed to sync Bond #${bondId}:`, error);\n}\n// 경쟁 조건 가능한 스케줄링\nsetInterval(runSync, CONFIG.SYNC_INTERVAL_MS);\n```\n\n**조치 방안**:\n- Exponential backoff 재시도 로직 구현\n- `setInterval` 대신 `setTimeout` 재귀 패턴으로 변경\n- Provider health check 및 fallback RPC endpoint 설정\n- 연속 실패 시 알림(Slack/Discord webhook 등) 발송\n\n---\n\n### 4.4 relayer.ts DEV_FALLBACK_KEY 하드코딩\n\n**위치**: `frontend/app/lib/relayer.ts`\n\n**현황**: 프론트엔드 릴레이어 모듈에 Hardhat #0 계정의 private key가 fallback으로 하드코딩되어 있다. `RELAYER_PRIVATE_KEY` 환경변수가 없을 때 자동으로 이 키를 사용한다.\n\n**조치 방안**: fallback 키 완전 제거. 환경변수 미설정 시 명시적 에러 throw\n\n---\n\n### 4.5 Setter 함수 Zero-Address 검증 누락\n\n**위치**: `YieldDistributor.sol:34-36,61-63`, `OracleAdapter.sol:37-39`\n\n**현황**: `setBondToken()`, `setLiquidityPool()`, `setYieldDistributor()` 등 admin setter에 `require(_addr != address(0))` 검증이 없다. Admin 실수로 zero address 설정 시 자금 영구 잠김 가능.\n\n---\n\n### 4.6 프론트엔드 ErrorBoundary 및 404 페이지 부재\n\n**위치**: `frontend/app/routes/` 전체\n\n**현황**:\n- React ErrorBoundary가 라우트 레벨에 없어, API 실패나 렌더링 에러 시 전체 페이지가 깨짐\n- Wildcard 라우트(404)가 없어 잘못된 URL 접근 시 빈 페이지 노출\n- AGENTS.md `[Strict DoD]` 항목 1(\"모든 신규 페이지 진입 가능, No 404\") 위반 가능성\n\n---\n\n### 4.7 CSRF 보호 및 보안 헤더 미설정\n\n**위치**: `frontend/app/routes/api.*.ts` 전체\n\n**현황**:\n- POST 엔드포인트에 origin/referer 검증 없음\n- CSP(Content Security Policy), X-Frame-Options 등 보안 헤더 미설정\n- `/api/chat`에 인증 없음 - 외부에서 직접 호출하여 AI 토큰 소비 가능\n\n---\n\n## 5. P2 - 중기 개선 필요 (Medium)\n\n### 5.1 환경변수 Startup 검증 부재\n\n**위치**: 프론트엔드/릴레이어 전반\n\n**현황**: `GEMINI_API_KEY`, `CHOONSIM_API_KEY`, `RELAYER_PRIVATE_KEY`, `TURSO_*` 등 필수 환경변수가 런타임에 검증 없이 사용된다. 누락 시 암묵적 실패(undefined 참조, 빈 문자열 fallback)가 발생한다.\n\n**조치 방안**: 서버 시작 시 Zod 스키마로 모든 필수 환경변수 존재 여부 검증\n\n---\n\n### 5.2 `as any` 타입 캐스팅 남용\n\n**위치**: `advanced-oracle-module.tsx:76`, `yield-deposit-module.tsx:61`, `api.chat.ts:25-27,31`, `relayer/src/index.ts:56-57`\n\n**현황**: 컨트랙트 반환 타입을 `as any`로 캐스팅하여 타입 안정성이 무력화되어 있다. AGENTS.md `[Self-Review First]`의 \"Any 사용 지양\" 규칙 위반.\n\n```typescript\n// 예시\nconst currentInterestInWei = currentPerformance ? (currentPerformance as any).interestPaid : BigInt(0);\n```\n\n**조치 방안**: 컨트랙트 ABI에서 반환 타입을 추론하는 유틸리티 타입 정의\n\n---\n\n### 5.3 Admin 모듈 중복 코드\n\n**위치**: `frontend/app/components/admin/` (3개 파일, 총 975줄)\n\n**현황**: `oracle-trigger-module.tsx`, `yield-deposit-module.tsx`, `advanced-oracle-module.tsx` 세 컴포넌트에서 다음 로직이 ~400줄 이상 중복된다:\n- USDC allowance 확인 및 approve 플로우\n- 트랜잭션 상태 추적 (idle/approving/updating/success)\n- 트랜잭션 완료 후 refetch 로직\n- 에러 핸들링 및 Toast 알림\n\n**조치 방안**: 공통 hook (`useContractTransaction`) 추출\n\n---\n\n### 5.4 미사용 의존성\n\n**위치**: `frontend/package.json`\n\n**현황**:\n| 패키지 | 상태 | 비고 |\n|--------|------|------|\n| `zod` | 설치됨, 미사용 | AGENTS.md 필수이나 코드에 적용 안 됨 |\n| `lucide-react` | 설치됨, 미사용 | 모든 아이콘이 HugeIcons로 사용 중 |\n| `@base-ui/react` | 설치됨, import 없음 | 번들에 불필요하게 포함 |\n| `shadcn` (CLI) | production dep | devDependencies로 이동 필요 |\n\n`relayer/package.json`의 `axios`도 설치되어 있으나 미사용.\n\n**영향**: 불필요한 번들 크기 증가 (추정 ~200KB)\n\n---\n\n### 5.5 DB 쿼리 직렬 실행\n\n**위치**: `frontend/app/routes/choonsim.tsx` loader 함수\n\n**현황**: 여러 독립적 DB 쿼리가 순차적으로 실행되고 있다. `Promise.all()`로 병렬화하면 로딩 시간을 단축할 수 있다.\n\n---\n\n### 5.6 Chat API Dead Code\n\n**위치**: `frontend/app/routes/api.chat.ts:69-81`\n\n**현황**: 매 채팅 요청마다 Viem `createPublicClient`를 생성하지만, 생성된 `client` 변수가 실제로 사용되지 않는다. 불필요한 import와 인스턴스 생성으로 요청 처리 시간 증가.\n\n---\n\n### 5.7 Relayer 데이터 검증 부재\n\n**위치**: `relayer/src/index.ts:70-106`\n\n**현황**: `MockFintechAPI`의 반환값을 검증 없이 온체인에 제출한다. Zod 스키마 부재, 범위 검사 없음, timestamp 로직 fragile(`Math.floor(Date.now() / 1000) - 60`으로 \"Future timestamp\" 에러 우회).\n\n---\n\n## 6. P3 - 장기 개선 권장 (Low)\n\n### 6.1 모노레포 워크스페이스 미설정\n\n**현황**: 루트 `package.json`이 없어 `frontend/`, `contracts/`, `relayer/`가 독립적으로 관리된다.\n\n**권장**: npm workspaces 또는 pnpm workspaces로 통합하여 의존성 관리 및 스크립트 실행 일원화\n\n### 6.2 공유 타입 패키지 부재\n\n**현황**: 컨트랙트 ABI 타입, Bond 구조체 등이 frontend와 relayer에서 각각 별도 정의. 변경 시 양쪽 수동 동기화 필요.\n\n**권장**: `packages/types` 패키지를 만들어 ABI 타입, 주소 상수, 공통 인터페이스 공유\n\n### 6.3 스마트 컨트랙트 업그레이드 패턴 부재\n\n**현황**: 모든 컨트랙트가 non-upgradeable. 테스트넷에서는 문제없으나 메인넷 배포 시 버그 수정 불가.\n\n**권장**: 메인넷 전환 시 UUPS(Universal Upgradeable Proxy Standard) 도입 검토\n\n### 6.4 deploy_all.ts 스크립트 구버전\n\n**위치**: `contracts/scripts/deploy_all.ts`\n\n**현황**: `YieldDistributor` 생성자 시그니처가 현재 컨트랙트(`usdcAddress`만 수용)와 불일치하여 실행 시 실패. deprecated 표시 필요.\n\n### 6.5 이벤트 누락\n\n**위치**: `YieldDistributor.sol:71-73`, `OracleAdapter.sol:37-39`\n\n**현황**: `setAuditRequirement()`, `setYieldDistributor()` 등 admin setter 함수에 이벤트가 emit되지 않아 관리 감사 추적 불완전.\n\n### 6.6 Relayer 모니터링 체계 부재\n\n**현황**: 로그가 `console.log`로만 출력되며, 구조화된 로깅(Winston/Pino), 메트릭 수집(Prometheus), 알림(Slack/PagerDuty) 체계가 없다. 수동 진단 스크립트(`check-status.ts`, `diagnose-v2.ts`)는 존재하나 자동화되지 않음.\n\n---\n\n## 7. 긍정적 평가 (Positive Findings)\n\n본 감사에서 확인된 프로젝트의 강점:\n\n| 영역 | 평가 |\n|------|------|\n| AccessControl + ReentrancyGuard | 모든 자금 이동 함수에 일관되게 적용 |\n| YieldDistributor 설계 | \"Holding = Yield\" 패턴과 audit/verify 2단계 검증 구조가 잘 설계됨 |\n| 이벤트 로깅 | 핵심 상태 변경(BondPurchased, YieldClaimed, Reinvested 등)에 이벤트 완비 |\n| 5계층 문서 체계 | Foundation/Prototype/Specs/Logic/Test 구조와 상호 참조 체계가 체계적 |\n| 커밋 컨벤션 | AGENTS.md 한국어 커밋 규칙 일관 준수 |\n| 프론트엔드 스택 | React Router v7 SSR + Vercel 배포 + shadcn/ui + Tailwind v4 현대적 구성 |\n| 포트폴리오 Lazy Loading | 차트 컴포넌트의 코드 스플리팅 적용 |\n| 테스트 커버리지 | 컨트랙트 6개 테스트 스위트, Happy path 및 역할 기반 접근 제어 검증 포함 |\n\n---\n\n## 8. 우선순위 종합 매트릭스\n\n| 순위 | 항목 | 영역 | 영향도 | AGENTS.md 위반 |\n|------|------|------|--------|----------------|\n| P0 | .env 크레덴셜 Git 노출 | 보안 | 전체 서비스 키 탈취 | Zero-Leak Secret Policy |\n| P0 | Faucet Rate Limiting 부재 | API | 릴레이어 지갑 잔고 고갈 | - |\n| P0 | API Zod 검증 부재 | API | 비정상 데이터 주입 | Validation (Zod 필수) |\n| P0 | 컨트랙트 Pausable 미적용 | 컨트랙트 | 긴급 상황 대응 불가 | - |\n| P0 | SafeERC20 미사용 | 컨트랙트 | Silent transfer failure | - |\n| P1 | Bond 투자 상한선 없음 | 컨트랙트 | 무제한 민팅 가능 | - |\n| P1 | reinvest() CEI 위반 | 컨트랙트 | 자금 손실 위험 | - |\n| P1 | Relayer 재시도/복구 부재 | 릴레이어 | 동기화 누락 | Evidence-Based Response |\n| P1 | DEV_FALLBACK_KEY 하드코딩 | 보안 | Private key 노출 | Zero-Leak Secret Policy |\n| P1 | Setter zero-address 검증 | 컨트랙트 | 자금 영구 잠김 | - |\n| P1 | ErrorBoundary/404 부재 | UX | 빈 페이지 노출 | Strict DoD |\n| P1 | CSRF/보안 헤더 미설정 | 보안 | 외부 공격 취약 | - |\n| P2 | 환경변수 Startup 검증 | 운영 | 런타임 장애 | - |\n| P2 | `as any` 타입 캐스팅 | 코드 품질 | 타입 안정성 | Self-Review First |\n| P2 | Admin 모듈 중복 코드 | 코드 품질 | 유지보수 비용 | - |\n| P2 | 미사용 의존성 | 번들 | ~200KB 불필요 포함 | - |\n| P2 | DB 쿼리 직렬 실행 | 성능 | 페이지 로딩 지연 | React Performance |\n| P2 | Chat API Dead Code | 코드 품질 | 불필요한 리소스 소비 | Self-Review First |\n| P2 | Relayer 데이터 검증 | 릴레이어 | 비정상 데이터 온체인 제출 | Validation (Zod 필수) |\n| P3 | 모노레포 워크스페이스 | 구조 | 개발 효율성 | - |\n| P3 | 공유 타입 패키지 | 구조 | 변경 동기화 누락 | - |\n| P3 | 컨트랙트 업그레이드 패턴 | 컨트랙트 | 메인넷 대응 불가 | - |\n| P3 | deploy_all.ts 구버전 | 배포 | 실행 시 실패 | - |\n| P3 | Admin setter 이벤트 누락 | 컨트랙트 | 감사 추적 불완전 | - |\n| P3 | Relayer 모니터링 | 운영 | 장애 감지 불가 | Zero-Failure Verification |\n\n---\n\n## 9. 문서-구현 정합성 이슈\n\n### 9.1 오라클 봇 위치 불일치\n\nCLAUDE.md에서 relayer를 \"Off-chain oracle data sync service\"로 설명하지만, 최근 커밋(`518e7179`, `6c48e770`)에서 오라클 봇의 핵심 기능이 프론트엔드 `scripts/oracle-bot.js`로 이동했다. 문서가 현재 아키텍처를 반영하지 못하고 있다.\n\n### 9.2 릴레이어 운영 문서 부재\n\n5계층 문서 체계에 릴레이어의 배포, 모니터링, 장애 대응에 대한 문서가 없다. `03_Specs/`에 릴레이어 운영 가이드 추가가 필요하다.\n\n### 9.3 AGENTS.md 준수 현황\n\n| 규칙 | Frontend | Contracts | Relayer |\n|------|----------|-----------|---------|\n| Zod 필수 사용 | 미준수 (설치만 됨) | N/A | 미준수 |\n| Luxon 날짜 처리 | 준수 | N/A | 미준수 (Date 직접 사용) |\n| Any 사용 지양 | 부분 위반 (4건+) | N/A | 위반 (2건) |\n| console.log 제거 | 부분 위반 (API routes) | N/A | 전면 위반 |\n| Zero-Leak Secret | 위반 (.env 커밋) | 준수 | 준수 |\n\n---\n\n## X. Related Documents\n- **Foundation**: [Project Overview](../01_Foundation/00_PROJECT_OVERVIEW.md) - 프로젝트 비전 및 아키텍처 참조\n- **Foundation**: [Roadmap](../01_Foundation/03_ROADMAP.md) - 단계별 구현 계획 및 완료 기준\n- **Specs**: [Infrastructure](../03_Specs/01_INFRASTRUCTURE.md) - 배포 환경 및 컨트랙트 주소\n- **Specs**: [Revenue Bridge Spec](../03_Specs/02_REVENUE_BRIDGE_SPEC.md) - api.revenue 입력 검증 관련\n- **Logic**: [Audit Logic](../04_Logic/01_AUDIT_LOGIC.md) - 오라클 검증 로직 및 릴레이어 연관\n- **Test**: [QA Checklist](./02_QA_CHECKLIST.md) - Phase-Exit 기준 및 DoD 체크리스트\n- **Test**: [Phase Completion Summary](./01_PHASE_COMPLETION_SUMMARY.md) - 기존 단계별 완료 보고서\n"
  }
]